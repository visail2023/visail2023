(this["webpackJsonpcalliope-lite-backbone"]=this["webpackJsonpcalliope-lite-backbone"]||[]).push([[5],{149:function(t,e,a){"use strict";a.d(e,"a",(function(){return r}));var r={trend:{width:600,height:280},forecasting:{width:600,height:280},frequent_pattern:{width:600,height:280},seasonality:{width:600,height:280},univariate_outlier:{width:600,height:280},univariate_distribution:{width:600,height:280},similarity:{width:600,height:360},multivariate_outlier:{width:600,height:360},multivariate_distribution:{width:550,height:420},clustering:{width:314,height:216},origin:{width:600,height:360},outstanding:{width:600,height:280},autocorrelation:{width:600,height:280}}},150:function(t,e,a){"use strict";a.d(e,"a",(function(){return Ot}));var r=a(13),n=a(14),i=a(16),l=a(15),o=a(0),s=a.n(o),d=a(118),c=function(){function t(){Object(r.a)(this,t),this._table=[],this._schema=[]}return Object(n.a)(t,[{key:"table",value:function(){return this._table}},{key:"schema",value:function(){return this._schema}},{key:"load",value:function(t){var e=this;return new Promise((function(a,r){var n=[],i=t.schema.filter((function(t){return"numerical"===t.type}));if(n=i.map((function(t){return t.field})),"values"in t){var l=t.values;l.forEach((function(t,e){for(var a in t)-1!==n.indexOf(a)&&(t[a]=parseFloat(t[a]))})),e._table=l,e._schema=t.schema,a(e)}else d.e(t.url).then(function(e){e.forEach((function(t,e){for(var a in t)-1!==n.indexOf(a)&&(t[a]=parseFloat(t[a]))})),this._table=e,this._schema=t.schema,a(this)}.bind(e)).catch((function(t){r(t)}))}))}}]),t}(),p=a(123),f={SUM:"sum",MAX:"max",MIN:"min",AVG:"avg",COUNT:"count",NONE:"none"},h=function(){function t(){Object(r.a)(this,t),this._table=[],this._schema=[],this._factdata=[],this._type="",this._measure=[],this._subspace=[],this._breakdown=[],this._parameter="",this._focus=[]}return Object(n.a)(t,[{key:"table",value:function(t){if(!t)return this._table;this._table=t,this._factdata=t}},{key:"schema",value:function(t){this._schema=t}},{key:"factdata",value:function(){return this._factdata}},{key:"fact",value:function(){return{type:this._type,measure:this._measure,subspace:this._subspace,breakdown:this._breakdown,focus:this._focus,parameter:this._parameter}}},{key:"load",value:function(t){var e=this;this._type=t.type,this._measure=t.measure?t.measure:[],0===this._measure.length&&(this._measure=[{aggregate:"count"}]),this._subspace=t.subspace?t.subspace:[],this._breakdown=t.breakdown?t.breakdown:[],this._focus=t.focus?t.focus:[];var a,r={},n=Object(p.a)(this._schema);try{for(n.s();!(a=n.n()).done;){var i=a.value;r[i.field]={},r[i.field].subtype=i.subtype,r[i.field].pictype=i.pictype,r[i.field].type=i.type,r[i.field].values=i.values,r[i.field].isPostCode=i.isPostCode}}catch(s){n.e(s)}finally{n.f()}if(this._measure=this._measure.map((function(t){return"field"in t&&(t.type=r[t.field].type,r[t.field].subtype&&(t.subtype=r[t.field].subtype),r[t.field].pictype&&(t.pictype=r[t.field].pictype)),t})),this._subspace=this._subspace.map((function(t){return"NaN"!==parseInt(t).toString||(t.type=r[t.field].type,r[t.field].subtype&&(t.subtype=r[t.field].subtype),r[t.field].pictype&&(t.pictype=r[t.field].pictype),r[t.field].isPostCode&&(t.isPostCode=r[t.field].isPostCode)),t})),this._breakdown=this._breakdown.map((function(t){return t.type=r[t.field].type,r[t.field].subtype&&(t.subtype=r[t.field].subtype),r[t.field].pictype&&(t.pictype=r[t.field].pictype),r[t.field].values&&(t.values=r[t.field].values),r[t.field].isPostCode&&(t.isPostCode=r[t.field].isPostCode),t})),this._focus=this._focus.map((function(t){return t.type=r[t.field].type,r[t.field].subtype&&(t.subtype=r[t.field].subtype),r[t.field].pictype&&(t.pictype=r[t.field].pictype),t})),this._subspace.length>0&&(this._factdata=this.filter(this.factdata(),this._subspace)),this._measure.length>0){var l=this._measure,o=this._breakdown;this._factdata=this.aggregate(this._factdata,l,o)}try{this._parameter=this.parameter()}catch(d){console.log("parameter is wrong")}return new Promise((function(t,a){t(e)}))}},{key:"parameter",value:function(){this.factdata();var t=this.fact();t.breakdown,t.focus,t.measure}},{key:"filter",value:function(t,e){var a=t;if("NaN"!==parseInt(e[0]).toString())return 2===e.length?t.slice(e[0],e[1]+1):t;if(e[0].hasOwnProperty("operator"))return e.forEach((function(t){switch(t.operator){case"EQ":a=a.filter((function(e){return Math.abs(e[t.field]-parseFloat(t.value[0]))<.01}));break;case"IN":a=a.filter((function(e){return t.value.includes(e[t.field])}));break;case"RANGE":var e=parseFloat(t.value[0]),r=parseFloat(t.value[1]),n=e,i=r;e<r&&(n=r,i=e),a=a.filter((function(e){return e[t.field]>=i&&e[t.field]<=n}));break;case"NOT RANGE":var l=parseFloat(t.value[0]),o=parseFloat(t.value[1]),s=l,d=o;l<o&&(s=o,d=l),a=a.filter((function(e){return e[t.field]<d||e[t.field]>s}));break;case"GT":a=a.filter((function(e){return e[t.field]>parseFloat(t.value[0])}));break;case"LT":a=a.filter((function(e){return e[t.field]<parseFloat(t.value[0])}));break;default:console.log("operator error!not in [GT,IN,LT,NOT RANGE,RANGE,EQ]")}})),a;var r,n=Object(p.a)(e);try{var i=function(){var t=r.value;a=a.filter((function(e){return e[t.field]===t.value}))};for(n.s();!(r=n.n()).done;)i()}catch(l){n.e(l)}finally{n.f()}return a}},{key:"aggregate",value:function(t,e,a){return t}},{key:"agg",value:function(t,e,a){var r={},n=[];n=n.concat(a.map((function(t){return t.field}))),"count"!==e.aggregate&&n.push(e.field);for(var i=0,l=Object.keys(e);i<l.length;i++){var o=l[i];n.push(e[o])}switch(r=t.map((function(t){var e,a={},r=Object(p.a)(n);try{for(r.s();!(e=r.n()).done;){var i=e.value;a[i]=t[i]}}catch(l){r.e(l)}finally{r.f()}return a})),e.aggregate){case f.SUM:r=this.sum(r,e,a);break;case f.AVG:r=this.avg(r,e,a);break;case f.MAX:r=this.max(r,e,a);break;case f.MIN:r=this.min(r,e,a);break;case f.COUNT:r=this.count(r,e,a);break;default:r=this.max(r,e,a)}return r}},{key:"sum",value:function(t,e,a){var r=[];if(a.length>1){var n,i=d.p().key((function(t){return t[a[1].field]})).entries(t),l=Object(p.a)(i);try{var o=function(){var t=n.value,i=d.p().key((function(t){return t[a[0].field]})).entries(t.values),l=new Array(i.length).fill(0),o=i.map((function(t,a){t.values.forEach((function(t){l[a]+=t[e.field]}));var r=Object.assign({},t.values[0]);return r[e.field]=l[a],r}));r=r.concat(o)};for(l.s();!(n=l.n()).done;)o()}catch(u){l.e(u)}finally{l.f()}}else if(1===a.length){var s=d.p().key((function(t){return t[a[0].field]})).entries(t),c=new Array(s.length).fill(0);r=s.map((function(t,a){t.values.forEach((function(t){c[a]+=t[e.field]}));var r=Object.assign({},t.values[0]);return r[e.field]=c[a],r}))}else{var f={};f[e.field]=0;for(var h=0;h<t.length;h++)f[e.field]+=t[h][e.field];r.push(f)}return r}},{key:"avg",value:function(t,e,a){var r=[];if(a.length>1){var n,i=d.p().key((function(t){return t[a[1].field]})).entries(t),l=Object(p.a)(i);try{var o=function(){var t=n.value,i=d.p().key((function(t){return t[a[0].field]})).entries(t.values),l=new Array(i.length).fill(0),o=i.map((function(t,a){t.values.forEach((function(t){l[a]+=t[e.field]}));var r=Object.assign({},t.values[0]);return r[e.field]=l[a]/t.values.length,r}));r=r.concat(o)};for(l.s();!(n=l.n()).done;)o()}catch(u){l.e(u)}finally{l.f()}}else if(1===a.length){var s=d.p().key((function(t){return t[a[0].field]})).entries(t),c=new Array(s.length).fill(0);r=s.map((function(t,a){t.values.forEach((function(t){c[a]+=t[e.field]}));var r=Object.assign({},t.values[0]);return r[e.field]=c[a]/t.values.length,r}))}else{var f={};f[e.field]=0;for(var h=0;h<t.length;h++)f[e.field]+=t[h][e.field];f[e.field]/=t.length,r.push(f)}return r}},{key:"max",value:function(t,e,a){var r=[];if(a.length>1){var n,i=d.p().key((function(t){return t[a[1].field]})).entries(t),l=Object(p.a)(i);try{for(l.s();!(n=l.n()).done;){var o=n.value,s=d.p().key((function(t){return t[a[0].field]})).entries(o.values).map((function(t,a){var r=d.v(t.values,(function(t,a){if(t[e.field]&&a[e.field])return a[e.field]-t[e.field]}));return r>=0?t.values[r]:t.values[0]}));r=r.concat(s)}}catch(h){l.e(h)}finally{l.f()}}else if(1===a.length){r=d.p().key((function(t){return t[a[0].field]})).entries(t).map((function(t,a){var r=d.v(t.values,(function(t,a){if(t[e.field]&&a[e.field])return a[e.field]-t[e.field]}));return r>=0?t.values[r]:t.values[0]}))}else{var c={};c[e.field]=t[0][e.field];for(var f=0;f<t.length;f++)c[e.field]<t[f][e.field]&&(c[e.field]=t[f][e.field]);r.push(c)}return r}},{key:"min",value:function(t,e,a){var r=[];if(a.length>1){var n,i=d.p().key((function(t){return t[a[1].field]})).entries(t),l=Object(p.a)(i);try{for(l.s();!(n=l.n()).done;){var o=n.value,s=d.p().key((function(t){return t[a[0].field]})).entries(o.values).map((function(t){var a=d.v(t.values,(function(t,a){if(t[e.field]&&a[e.field])return t[e.field]-a[e.field]}));return a>=0?t.values[a]:t.values[0]}));r=r.concat(s)}}catch(h){l.e(h)}finally{l.f()}}else if(1===a.length){r=d.p().key((function(t){return t[a[0].field]})).entries(t).map((function(t){var a=d.v(t.values,(function(t,a){if(t[e.field]&&a[e.field])return t[e.field]-a[e.field]}));return a>=0?t.values[a]:t.values[0]}))}else{var c={};c[e.field]=t[0][e.field];for(var f=0;f<t.length;f++)c[e.field]>t[f][e.field]&&(c[e.field]=t[f][e.field]);r.push(c)}return r}},{key:"count",value:function(t,e,a){var r=[];if(a.length>1){var n,i=d.p().key((function(t){return t[a[1].field]})).entries(t),l=Object(p.a)(i);try{var o=function(){var t=n.value,e=d.p().key((function(t){return t[a[0].field]})).entries(t.values),i=new Array(e.length).fill(0),l=e.map((function(t,e){t.values.forEach((function(){i[e]+=1}));var a=t.values[0];return a.COUNT=i[e],a}));r=r.concat(l)};for(l.s();!(n=l.n()).done;)o()}catch(h){l.e(h)}finally{l.f()}}else if(1===a.length){var s=d.p().key((function(t){return t[a[0].field]})).entries(t),c=new Array(s.length).fill(0);r=s.map((function(t,e){t.values.forEach((function(){c[e]+=1}));var a=t.values[0];return a.COUNT=c[e],a}))}else{var f={COUNT:t.length};r.push(f)}return r}}]),t}(),u={FREQUENT_PATTERN:"frequent_pattern",UNIVARIATE_OUTLIER:"univariate_outlier",MULTIVARIATE_OUTLIER:"multivariate_outlier",TREND:"trend",FORECASTING:"forecasting",UNIVARIATE_DISTRIBUTION:"univariate_distribution",MULTIVARIATE_DISTRIBUTION:"multivariate_distribution",SEASONALITY:"seasonality",CLUSTERING:"clustering",SIMILARITY:"similarity",ORIGIN:"origin",AUTOCORRELATION:"autocorrelation",OUTSTANDING:"outstanding"},y=function(){function t(){Object(r.a)(this,t),this._container=document.createElement("div"),this._width=0,this._height=0,this._table=[],this._factdata=[],this._subspace=[],this._measure=[],this._breakdown=[],this._focus=[],this._duration=0,this._showTooltip=!1,this._showSuggestion=!1}return Object(n.a)(t,[{key:"container",value:function(t){if(!t)return d.w(this._container).selectAll("*").remove(),this._container;this._container=t}},{key:"style",value:function(t){if(!t)return this._style;this._style=t}},{key:"size",value:function(t){if(!t)return this._size;this._size=t}},{key:"width",value:function(t){if(!t)return 0!==this._width?this._width:640;this._width=t}},{key:"height",value:function(t){if(!t)return 0!==this._height?this._height:400;this._height=t}},{key:"table",value:function(t){if(!t)return this._table;this._table=t}},{key:"factdata",value:function(t){if(!t)return this._factdata;this._factdata=t}},{key:"subspace",value:function(t){if(!t)return this._subspace;this._subspace=t}},{key:"measure",value:function(t){if(!t)return this._measure;this._measure=t}},{key:"breakdown",value:function(t){if(!t)return this._breakdown;this._breakdown=t}},{key:"focus",value:function(t){if(!t)return this._focus;this._focus=t}},{key:"duration",value:function(t){if(!t)return this._duration;this._duration=t}},{key:"showSuggestion",value:function(t){if(!t)return this._showSuggestion;this._showSuggestion=t}},{key:"showTooltip",value:function(t){if(!t)return this._showTooltip;this._showTooltip=t}},{key:"toSVG",value:function(){}},{key:"toJPG",value:function(){}}]),t}(),x=function(t){return d.D("%Y-%m-%d")(t)?d.D("%Y-%m-%d")(t):d.D("%Y/%m/%d")(t)?d.D("%Y/%m/%d")(t):d.D("%Y-%m")(t)?d.D("%Y-%m")(t):d.D("%Y/%m")(t)?d.D("%Y/%m")(t):d.D("%Y")(t)?d.D("%Y")(t):d.D("%Y-%m-%dT%H:%M:%S.%fZ")(t)?d.D("%Y-%m-%dT%H:%M:%S.%fZ")(t):d.D("%Y-%m-%d %H:%M:%S")(t)?d.D("%Y-%m-%d %H:%M:%S")(t):d.D("%Y-%m-%d %H:%M:%S.%f")(t)?d.D("%Y-%m-%d %H:%M:%S.%f")(t):t},g=function(t){return d.D("%Y-%m-%d")(t)?d.B("%Y-%-m-%-d"):d.D("%Y/%m/%d")(t)?d.B("%Y/%-m/%-d"):d.D("%Y-%m")(t)?d.B("%Y%-m"):d.D("%Y/%m")(t)?d.B("%Y/%m"):d.D("%Y")(t)?d.B("%Y"):d.D("%Y-%m-%dT%H:%M:%S.%fZ")(t)?d.B("%Y-%m-%dT%H:%M:%S.%fZ"):d.D("%Y-%m-%d %H:%M:%S")(t)?d.B("%Y-%m-%d %H:%M:%S"):d.D("%Y-%m-%d %H:%M:%S.%f")(t)?d.B("%Y-%m-%d %H:%M:%S.%f"):""},v=function(t){return d.D("%Y-%m-%d")(t)||d.D("%Y/%m/%d")(t)?d.A:d.D("%Y-%m")(t)||d.D("%Y/%m")(t)?d.C:d.D("%Y")(t)?d.E:d.D("%Y-%m-%dT%H:%M:%S.%fZ")(t)?d.B("%Y-%m-%dT%H:%M:%S.%fZ"):d.D("%Y-%m-%d %H:%M:%S")(t)?d.B("%Y-%m-%d %H:%M:%S"):d.D("%Y-%m-%d %H:%M:%S.%f")(t)?d.B("%Y-%m-%d %H:%M:%S.%f"):void 0},m=864e5,w=["#6C8EF2","#E1944E","#8B65BA","#4B8384"],k=function(t){Object(i.a)(a,t);var e=Object(l.a)(a);function a(){var t;return Object(r.a)(this,a),(t=e.call(this))._x="",t._y="",t}return Object(n.a)(a,[{key:"display",value:function(){var t=this.factdata(),e=(this.measure(),this.breakdown()),a=this.focus(),r=t=t.sort((function(t,a){return x(t[e[0].field])-x(a[e[0].field])}));if(0!==a.length){var n=600,i=360,l=15,o=5,s=n-o-20,c=i-l-15,f=(this.container(),d.w(this.container()).append("svg").attr("width",n).attr("height",i).append("g").attr("transform","translate("+(o+10)+","+l+")").attr("font-family","OPPOSans")),h=f.append("g").attr("class","lineLayer"),u=d.u().range([30,s-10]);u.domain(d.i(r,(function(t){return x(t[e[0].field])})));var y=v(r[0][e[0].field]),m=g(r[0][e[0].field]),k=d.b(u).tickFormat(m);y===d.E&&k.ticks(y);var b,_=f.append("g").attr("class","tooltip"),O=[],A=f.append("g").attr("class","yAxis"),F=[],P=(c-20+15)/a[0].clusters.length,S=Object(p.a)(a);try{for(S.s();!(b=S.n()).done;){var B=b.value,E=Math.max(0,B.start-1),M=Math.min(r.length-1,B.end+1);O.push(x(r[E][e[0].field])),O.push(x(r[M][e[0].field]));for(var Y=function(){var t=B.clusters[C],a=d.t().range([P*(C+1)-15,P*C]);h.append("g").selectAll("line.line").data(a.ticks(5)).enter().append("line").attr("x1",30).attr("x2",n).attr("y1",(function(t){return a(t)})).attr("y2",(function(t){return a(t)})).attr("stroke","#E6E6E6").attr("stroke-width","2px"),_.append("rect").attr("width",u(x(r[M][e[0].field]))-u(x(r[E][e[0].field]))).attr("height",P-15).style("fill","rgb(100%,"+100*(1-t.center.score)+"%,"+100*(1-t.center.score)+"%, 50%)").attr("x",u(x(r[E][e[0].field]))).attr("y",P*C),C===B.clusters.length-1&&_.append("rect").attr("width",u(x(r[M][e[0].field]))-u(x(r[E][e[0].field]))).attr("height",10).style("fill","red").attr("x",u(x(r[E][e[0].field]))).attr("y",P*(C+1)-15),a.domain([0,1]);var i,l=Object(p.a)(t.other);try{var o=function(){var t=i.value;a.domain(d.i([].concat(r.map((function(e){return e[t.field]})))));var n=d.l().curve(d.g).x((function(t){return u(x(t[e[0].field]))})).y((function(e){return a(e[t.field])}));h.append("path").attr("d",n(r)).attr("stroke","#808080").attr("stroke-width","2px").attr("fill","none").attr("opacity",.5)};for(l.s();!(i=l.n()).done;)o()}catch(m){l.e(m)}finally{l.f()}a.domain([0,1]);for(var s=d.l().curve(d.g).x((function(t){return u(x(t.x))})).y((function(t){return a(t.y)})),c=[],f=0;f<t.center.value.length;f++)c.push({x:r[E+f][e[0].field],y:t.center.value[f]});_.append("path").attr("d",s(c)).attr("stroke",w[C]).attr("stroke-width","2px").attr("fill","none");var y=[];y.push({x:r[E][e[0].field],y:t.center.value[0]});for(var g=0;g<t.center.forecast.length;g++)y.push({x:r[E+1+g][e[0].field],y:t.center.forecast[g]});y.push({x:r[M][e[0].field],y:t.center.value[t.center.value.length-1]}),_.append("path").attr("d",s(y)).attr("stroke",w[C]).attr("stroke-width","2px").attr("stroke-dasharray","6, 3").attr("fill","none"),B.clusters.length<=3&&a.domain(d.i([].concat(r.map((function(e){return e[t.other[0].field]}))))),A.append("g").attr("transform","translate(30, 0)").call(d.c(a).ticks(5).tickFormat((function(t){return t/1e6>=1?t=t/1e6+"M":t/1e3>=1&&(t=t/1e3+"K"),t}))).call((function(t){t.attr("font-size","10px"),t.attr("font-weight","light"),t.attr("font-family","OPPOSans");var e=t.selectAll(".domain").attr("d");e=(e=e.replace("M-6","M-"+6*n/640)).replace("H-6","H-"+6*n/640),t.selectAll(".domain").attr("d",e).attr("stroke-width",2),t.selectAll(".tick").select("line").attr("stroke","#000000").attr("stroke-width",2).attr("x2",-6*n/640),t.selectAll("text").attr("x",-9*n/640)}));var v=A.append("text").attr("transform","rotate(-90)").attr("y",-5).attr("x",0-(P*(2*C+1)-15)/2).style("text-anchor","middle").style("font-size","10px").text(t.other[0].field);A.append("rect").attr("transform","rotate(-90)").style("text-anchor","middle").attr("x",v.node().getBBox().x).attr("y",v.node().getBBox().y).attr("width",v.node().getBBox().width+2).attr("height",v.node().getBBox().height).attr("fill",w[C]),v.node().remove(),A.append("text").attr("transform","rotate(-90)").attr("y",-5).attr("x",0-(P*(2*C+1)-15)/2).style("text-anchor","middle").style("font-size","10px").text(t.other[0].field),F.push(a)},C=0;C<B.clusters.length;C++)Y();var T=_.append("g"),z=T.append("text").attr("font-size","10px").attr("font-family","OPPOSans").attr("stroke","#F72D35");z.append("tspan").text("Anomaly score: "+B.score.toFixed(4)).attr("dy",.9*z.selectAll("tspan").node().getBBox().height);var j=T.node().getBBox().width,D=T.node().getBBox().height,N=c,I=(u(x(r[E][e[0].field]))+u(x(r[M+1][e[0].field])))/2;T.append("image").attr("xlink:href","./alert.svg").attr("width","15px").attr("height","13px").attr("x",I-(j+17)/2).attr("y",N+2),z.attr("width",j).attr("height",D).attr("x",I-(j+17)/2+17).attr("y",N)}}catch(V){S.e(V)}finally{S.f()}return k.tickValues(O),f.append("g").attr("class","xAxis").attr("transform","translate(0,"+(c-20)+")").call(k).attr("font-family","OPPOSans").call((function(t){t.attr("font-size",10),t.attr("font-family","OPPOSans");var e=t.selectAll(".domain").attr("d");e=(e=e.replace("6V",6*i/320+"V")).replace("V6","V"+6*i/320),t.selectAll(".domain").attr("d",e).attr("stroke-width",2),t.selectAll(".tick").selectAll("line").attr("stroke","#000000").attr("stroke-width",2).attr("y2",6*i/320),t.selectAll("text").attr("y",9*i/320);var a=t.selectAll("text").nodes();d.w(a[0]).attr("x",-a[0].getBBox().width/2+5),d.w(a[1]).attr("x",a[0].getBBox().width/2-5)})),f}}}]),a}(y);function b(){var t=0,e=0,a=a||window.event;return a.pageX||a.pageY?(t=a.pageX,e=a.pageY):(a.clientX||a.clientY)&&(t=a.clientX+document.documentElement.scrollLeft+document.body.scrollLeft,e=a.clientY+document.documentElement.scrollTop+document.body.scrollTop),{posX:t,posY:e}}var _=function(t){Object(i.a)(a,t);var e=Object(l.a)(a);function a(){var t;return Object(r.a)(this,a),(t=e.call(this))._x="",t._y="",t}return Object(n.a)(a,[{key:"display",value:function(){var t=this.parseFact(),e=t._data,a=t._measure,r=t._breakdown,n=t._focus,i=t._measureName;if(0!==n.length&&(!r[1]||!r[1].field)){var l=this.setChartStandard(),o=l._chartSize,s=l._width,d=l._height,c=l._margin,p=this.initSvg(o,c),f=p.append("g").attr("class","tooltip"),h=this.drawXAxis(p,e,r,s,d,o),u=h._x,y=h._axisX,g=h._tick_format,v=this.drawYAxis(p,e,a,o,d),m=u(x(e[0][r[0].field])),w=u(x(e[e.length-1][r[0].field])),k=this.drawUnivariateDistribution(v,e,m,w,r,n,p,f,y),b=k._mean,_=k._x_mean,A=k._y_mean;f=k._tooltipLayer;var F=p.append("g").attr("class","lineLayer"),P=this.drawBackLine(u,v,e,F,r,i,s),S=P._rawPath;P._lineGen;return this.drawInsightText(p,v,m,w,b,_,A),this._showTooltip&&O("#whole-container",S,u,v,d,e,r,i,g,f),p}}},{key:"parseFact",value:function(){var t=this.factdata(),e=this.measure();return{_data:t,_measure:e,_breakdown:this.breakdown(),_focus:this.focus(),_measureName:"count"===e[0].aggregate?"COUNT":e[0].field}}},{key:"setChartStandard",value:function(){var t={width:600,height:280},e={top:15,right:20,bottom:15,left:20};return{_width:t.width-e.left-e.right,_height:t.height-e.top-e.bottom,_chartSize:t,_margin:e}}},{key:"initSvg",value:function(t,e){return d.w(this.container()).append("svg").attr("width",t.width).attr("height",t.height).append("g").attr("transform","translate("+(e.left+10)+","+e.top+")").attr("font-family","OPPOSans")}},{key:"drawXAxis",value:function(t,e,a,r,n,i){var l=d.u().range([0,r-20]);l.domain(d.i(e,(function(t){return x(t[a[0].field])})));var o=v(e[0][a[0].field]),s=g(e[0][a[0].field]),c=d.b(l).tickFormat(s);return o===d.E&&c.ticks(o),t.append("g").attr("class","xAxis").attr("transform","translate(0,"+(n-20)+")").call(c).call((function(t){t.attr("font-size","10px"),t.attr("font-family","OPPOSans"),t.attr("font-weight","light");var e=t.selectAll(".domain").attr("d");e=(e=e.replace("6V",6*i.height/320+"V")).replace("V6","V"+6*i.height/320),t.selectAll(".domain").attr("d",e).attr("stroke-width",2),t.selectAll(".tick").selectAll("line").attr("stroke","#000000").attr("stroke-width",2).attr("y2",5),t.selectAll("text").attr("y",10)})),{_x:l,_axisX:c,_tick_format:s}}},{key:"drawYAxis",value:function(t,e,a,r,n){var i=d.t().range([n-20,0]);return i.domain(d.i([].concat(e.map((function(t){return.85*t[a[0].field]})),e.map((function(t){return 1.15*t[a[0].field]}))))),t.append("g").attr("class","yAxis").call(d.c(i).ticks(5).tickFormat((function(t){return t/1e6>=1?t=t/1e6+"M":t/1e3>=1&&(t=t/1e3+"K"),t}))).call((function(t){t.attr("font-size","10px"),t.attr("font-weight","light"),t.attr("font-family","OPPOSans");var e=t.selectAll(".domain").attr("d");e=(e=e.replace("M-6","M-"+6*r.width/640)).replace("H-6","H-"+6*r.width/640),t.selectAll(".domain").attr("d",e).attr("stroke-width",2),t.selectAll(".tick").select("line").attr("stroke","#000000").attr("stroke-width",2).attr("x2",-5),t.selectAll("text").attr("x",-10)})),i}},{key:"drawBackLine",value:function(t,e,a,r,n,i,l){r.append("g").selectAll("line.line").data(e.ticks(5)).enter().append("line").attr("x1",0).attr("x2",l-20).attr("y1",(function(t){return e(t)})).attr("y2",(function(t){return e(t)})).attr("stroke","#E6E6E6").attr("stroke-width","2px");var o=d.l().curve(d.g).x((function(e){return t(x(e[n[0].field]))})).y((function(t){return e(t[i])}));return{_rawPath:r.append("path").attr("d",o(a)).attr("stroke","#6C8EF2").attr("stroke-width","3px").attr("fill","none"),_lineGen:o}}},{key:"drawUnivariateDistribution",value:function(t,e,a,r,n,i,l,o,s){var d,c=[],f=[0,0],h=0,u=0,y=0,g=Object(p.a)(i);try{for(g.s();!(d=g.n()).done;){var v=d.value,m=t(v.value);if("mean"===v.name)h=v.value,u=r,y=m;else if("mean-2std"===v.name)f[0]=v.value;else if("mean+2std"===v.name)f[1]=v.value;else if("min"===v.name){o.append("line").attr("x1",a).attr("y1",t(v.value)).attr("x2",r).attr("y2",t(v.value)).attr("stroke-width","1px").attr("stroke","black").attr("stroke-dasharray","6px");var w=o.append("text").attr("font-size","10px").attr("font-family","OPPOSans").attr("fill","#000000");w.append("tspan").text("Min: "+v.value).attr("dy",.9*w.selectAll("tspan").node().getBBox().height);var k=w.node().getBBox().width,b=1.5*w.node().getBBox().height;w.attr("width",k).attr("height",b).attr("x",r-k).attr("y",m-b)}else if("max"===v.name){o.append("line").attr("x1",a).attr("y1",t(v.value)).attr("x2",r).attr("y2",t(v.value)).attr("stroke-width","1px").attr("stroke","black").attr("stroke-dasharray","6px");var _=o.append("text").attr("font-size","10px").attr("font-family","OPPOSans").attr("fill","#000000");_.append("tspan").text("Max: "+v.value).attr("dy",.9*_.selectAll("tspan").node().getBBox().height);var O=_.node().getBBox().width,A=1.5*_.node().getBBox().height;_.attr("width",O).attr("height",A).attr("x",r-O).attr("y",m-A)}}}catch(F){g.e(F)}finally{g.f()}return l.append("rect").attr("x",0).attr("y",t(f[1])).attr("width",r-a).attr("height",t(f[0])-t(f[1])).attr("fill","#8ED9AB").attr("opacity",.3),c.push(x(e[10][n[0].field])),c.push(x(e[e.length-10][n[0].field])),s.tickValues(c),{_tooltipLayer:o,_mean:h,_x_mean:u,_y_mean:y}}},{key:"drawInsightText",value:function(t,e,a,r,n,i,l){var o=t.append("g").attr("class","tooltip").style("background-color","white").style("opacity",.8);o.append("line").attr("x1",a).attr("y1",e(n)).attr("x2",r).attr("y2",e(n)).attr("stroke-width","1px").attr("stroke","black");var s=o.append("text").attr("font-size","10px").attr("font-family","OPPOSans").attr("fill","#000000");s.append("tspan").text("Avg: "+n).attr("dy",.9*s.selectAll("tspan").node().getBBox().height);var d=s.node().getBBox().width,c=1.5*s.node().getBBox().height;t.append("rect").attr("x",i-d).attr("y",l-1.15*c).attr("width",d).attr("height",c).attr("fill","white").attr("opacity",.8),s.attr("width",d).attr("height",c).attr("x",i-d).attr("y",l-c);var p=t.append("g").attr("class","tooltip").style("background-color","white").style("opacity",.8).append("text").attr("font-size","10px").attr("font-family","OPPOSans").attr("fill","#000000");p.append("tspan").text("Avg: "+n).attr("dy",.9*p.selectAll("tspan").node().getBBox().height),p.attr("width",d).attr("height",c).attr("x",i-d).attr("y",l-c)}}]),a}(y),O=function(t,e,a,r,n,i,l,o,s,c){var p=d.w(t).append("div").attr("id","value-tooltip").style("z-index",2e3).style("width","95px").style("width","fit-content").style("opacity",0).style("position","absolute").style("pointer-events","none").style("border-radius","4px").style("background","#FFFFFF").style("box-shadow","0 0 5px #888888").style("padding","5px"),f=p.append("span").style("font","9px ".concat("OPPOSans")).style("font-weight","bold").style("display","block").style("color","#000000"),h=p.append("svg").attr("width","95px").attr("height","30px"),u=h.append("circle").attr("r",4).attr("cx","5px").attr("cy","12px"),y=h.append("text").style("font","8px ".concat("OPPOSans")).style("color","#000000").attr("x","14px").attr("y","14px");e.on("mouseover",(function(t){p.transition().duration(200).style("opacity",.9),v.transition().duration(200).style("opacity",1)})).on("mouseout",(function(t){document.elementFromPoint(d.h.pageX,d.h.pageY)!==w.node()&&(p.transition().duration(500).style("opacity",0),v.transition().duration(500).style("opacity",0))})).on("mousemove",(function(t){var e=b(),n=a.invert(d.o(this)[0]),c=g(i,n,1),h=x(i[c-1][l[0].field]),v=x(i[c][l[0].field]),k=n-h>v-n?v:h,_=k===h?i[c-1][o]:i[c][o],O=s(k);p.style("left",e.posX+30+"px").style("top",e.posY+20+"px"),f.html(O),u.style("fill","#6C8EF2"),y.html(o+": "+_.toFixed(2)),m.attr("x1",a(k)),m.attr("x2",a(k)),w.attr("cx",a(k)),w.attr("cy",r(_)),w.attr("stroke","#6C8EF2")}));var g=d.d((function(t){return x(t[l[0].field])})).left,v=c.append("g").style("opacity",0),m=v.append("line").attr("y1",n-20).attr("y2",0).attr("stroke-width","2px").attr("stroke","#E6E6E6").attr("stroke-dasharray","6, 3"),w=v.append("circle").attr("r",3).attr("fill","#FFFFFF").attr("stroke-width","2").style("box-shadow","0 0 5px #888888").on("mouseover",(function(t){p.transition().duration(200).style("opacity",.9),v.transition().duration(200).style("opacity",1)})).on("mouseout",(function(t){p.transition().duration(500).style("opacity",0),v.transition().duration(500).style("opacity",0)}))},A=_,F=function(t){Object(i.a)(a,t);var e=Object(l.a)(a);function a(){var t;return Object(r.a)(this,a),(t=e.call(this))._x="",t._y="",t}return Object(n.a)(a,[{key:"display",value:function(){var t=this.parseFact(),e=t._data,a=t._measure,r=t._breakdown,n=t._focus,i=t._measureName;if(0!==n.length&&(!r[1]||!r[1].field)){var l=this.setChartStandard(),o=l._chartSize,s=l._width,c=l._height,p=l._margin,f=this.initSvg(o,p),h=f.append("g").attr("class","lineLayer"),u=f.append("g").attr("class","tooltip"),y=d.u().range([0,s]);y.domain(d.i(e,(function(t){return x(t[r[0].field])})));var m=v(e[0][r[0].field]),w=g(e[0][r[0].field]),k=d.b(y).tickFormat(w);m===d.E&&k.ticks(m);var b=this.drawYAxis(f,e,a,o,c),_=this.drawBackLine(y,b,e,h,r,i,o),O=_._rawPath,A=_._lineGen;return this.drawTrend(y,b,f,e,r,a,n,i,c,h,u,k,A),this._showTooltip&&P("#whole-container",O,y,b,c,e,r,i,w,u),f.append("g").attr("class","xAxis").attr("transform","translate(0,"+(c-20)+")").call(k).call((function(t){t.attr("font-size","10px"),t.attr("font-family","OPPOSans"),t.attr("font-weight","lighter");var e=t.selectAll(".domain").attr("d");e=(e=e.replace("6V",6*o.height/320+"V")).replace("V6","V"+6*o.height/320),t.selectAll(".domain").attr("d",e).attr("stroke-width",2),t.selectAll(".tick").selectAll("line").attr("stroke","#000000").attr("stroke-width",2).attr("y2",5),t.selectAll("text").attr("y",10)})),f}}},{key:"parseFact",value:function(){var t=this.factdata(),e=this.measure(),a=this.breakdown(),r=this.focus(),n=t=t.sort((function(t,e){return x(t[a[0].field])-x(e[a[0].field])})),i="count"===e[0].aggregate?"COUNT":e[0].field;return{_data:n,_measure:e,_breakdown:a,_focus:r,_measureName:i}}},{key:"setChartStandard",value:function(){var t={width:600,height:280},e={top:15,right:20,bottom:15,left:20};return{_width:t.width-e.left-e.right,_height:t.height-e.top-e.bottom,_chartSize:t,_margin:e}}},{key:"initSvg",value:function(t,e){return d.w(this.container()).append("svg").attr("width",t.width).attr("height",t.height).append("g").attr("transform","translate("+(e.left+10)+","+e.top+")").attr("font-family","OPPOSans")}},{key:"drawYAxis",value:function(t,e,a,r,n){var i=d.t().range([n-20,0]);return i.domain(d.i([].concat(e.map((function(t){return.95*t[a[0].field]})),e.map((function(t){return 1.05*t[a[0].field]}))))),t.append("g").attr("class","yAxis").call(d.c(i).ticks(5).tickFormat((function(t){return t/1e6>=1?t=t/1e6+"M":t/1e3>=1&&(t=t/1e3+"K"),t}))).call((function(t){t.attr("font-size","10px"),t.attr("font-weight","lighter"),t.attr("font-family","OPPOSans");var e=t.selectAll(".domain").attr("d");e=(e=e.replace("M-6","M-"+6*r.width/640)).replace("H-6","H-"+6*r.width/640),t.selectAll(".domain").attr("d",e).attr("stroke-width",2),t.selectAll(".tick").select("line").attr("stroke","#000000").attr("stroke-width",2).attr("x2",-5),t.selectAll("text").attr("x",-10)})),i}},{key:"drawBackLine",value:function(t,e,a,r,n,i,l){r.append("g").selectAll("line.line").data(e.ticks(5)).enter().append("line").attr("x1",0).attr("x2",l.width).attr("y1",(function(t){return e(t)})).attr("y2",(function(t){return e(t)})).attr("stroke","#E6E6E6").attr("stroke-width","2px");var o=d.l().curve(d.g).x((function(e){return t(x(e[n[0].field]))})).y((function(t){return e(t[i])}));return{_rawPath:r.append("path").attr("d",o(a)).attr("stroke","#6C8EF2").attr("stroke-width","5px").attr("fill","none"),_lineGen:o}}},{key:"drawTrend",value:function(t,e,a,r,n,i,l,o,s,d,c,f,h){var u,y=[],g=Object(p.a)(l);try{for(g.s();!(u=g.n()).done;){var v=u.value,m=v.scope[0],w=v.scope[1],k=v.value,b=t(x(r[m][n[0].field])),_=t(x(r[w][n[0].field])),O=e(r[w-1][o]);c.append("line").attr("x1",b).attr("y1",e(r[m][o])).attr("x2",b).attr("y2",s-20).attr("stroke-width","1px").attr("stroke","black").attr("stroke-dasharray","6, 3"),c.append("line").attr("x1",_).attr("y1",e(r[w][o])).attr("x2",_).attr("y2",s-20).attr("stroke-width","1px").attr("stroke","black").attr("stroke-dasharray","6, 3");for(var A=[],F=m,P=0;F<w+1;F++,P++){var S={};S[n[0].field]=r[F][n[0].field],S[i[0].field]=l[0].regression[P],A.push(S)}d.append("path").attr("d",h(A)).attr("stroke-width","2px").attr("stroke","black").attr("stroke-dasharray","6, 3").attr("fill","none");var B=c.append("text").attr("font-size","10px").attr("font-family","OPPOSans").attr("font-weight","bold").attr("fill","#FFC111"),E=A[0][o]<A[A.length-1][o];B.append("tspan").text((E?"increasing "+(100*k).toFixed(2):"descreasing "+(100*k).toFixed(2))+"%").attr("dy",.9*B.selectAll("tspan").node().getBBox().height);var M=B.node().getBBox().width,Y=B.node().getBBox().height;B.attr("width",M).attr("height",Y).attr("x",_-M-10).attr("y",O-Y-80+(E?-5:15));var C=E?"./arrow-up.png":"./arrow-down.png";a.append("image").attr("xlink:href",C).attr("width","70px").attr("height","20px").attr("x",_-40).attr("y",O-Y-80),y.push(x(r[m][n[0].field])),y.push(x(r[w][n[0].field]))}}catch(T){g.e(T)}finally{g.f()}f.tickValues(y)}}]),a}(y),P=function(t,e,a,r,n,i,l,o,s,c){var p=d.w(t).append("div").attr("id","value-tooltip").style("z-index",2e3).style("width","fit-content").style("height","40px").style("opacity",0).style("position","absolute").style("pointer-events","none").style("border-radius","4px").style("background","#FFFFFF").style("box-shadow","0 0 5px #888888").style("padding","5px"),f=p.append("span").style("font","9px ".concat("OPPOSans")).style("font-weight","bold").style("display","block").style("color","#000000"),h=p.append("svg").attr("width","95px").attr("height","30px"),u=h.append("circle").attr("r",4).attr("cx","5px").attr("cy","12px"),y=h.append("text").style("font","8px ".concat("OPPOSans")).style("color","#000000").attr("x","14px").attr("y","14px");e.on("mouseover",(function(t){p.transition().duration(200).style("opacity",.9),v.transition().duration(200).style("opacity",1)})).on("mouseout",(function(t){document.elementFromPoint(d.h.pageX,d.h.pageY)!==w.node()&&(p.transition().duration(500).style("opacity",0),v.transition().duration(500).style("opacity",0))})).on("mousemove",(function(t){var e=b(),n=a.invert(d.o(this)[0]),c=g(i,n,1),h=x(i[c-1][l[0].field]),v=x(i[c][l[0].field]),k=n-h>v-n?v:h,_=k===h?i[c-1][o]:i[c][o],O=s(k);p.style("left",e.posX+30+"px").style("top",e.posY+20+"px"),f.html(O),u.style("fill","#6C8EF2"),y.html(o+": "+_.toFixed(2)),m.attr("x1",a(k)),m.attr("x2",a(k)),w.attr("cx",a(k)),w.attr("cy",r(_)),w.attr("stroke","#6C8EF2")}));var g=d.d((function(t){return x(t[l[0].field])})).left,v=c.append("g").style("opacity",0),m=v.append("line").attr("y1",n-20).attr("y2",0).attr("stroke-width","2px").attr("stroke","#E6E6E6").attr("stroke-dasharray","6, 3"),w=v.append("circle").attr("r",3).attr("fill","#FFFFFF").attr("stroke-width","2").style("box-shadow","0 0 5px #888888").on("mouseover",(function(t){p.transition().duration(200).style("opacity",.9),v.transition().duration(200).style("opacity",1)})).on("mouseout",(function(t){p.transition().duration(500).style("opacity",0),v.transition().duration(500).style("opacity",0)}))},S=F;function B(){for(var t=[],e=0;e<36;e++)t[e]="0123456789abcdef".substr(Math.floor(16*Math.random()),1);return t[14]="4",t[19]="0123456789abcdef".substr(3&t[19]|8,1),t[8]=t[13]=t[18]=t[23]="-",t.join("")}var E=function(t){Object(i.a)(a,t);var e=Object(l.a)(a);function a(){var t;return Object(r.a)(this,a),(t=e.call(this))._x="",t._y="",t}return Object(n.a)(a,[{key:"display",value:function(){var t=this.parseFact(),e=t._data,a=t._measure,r=t._breakdown,n=t._focus,i=t._measureName;if(0!==n.length&&(!r[1]||!r[1].field)){var l,o=this.setChartStandard(),s=o._chartSize,d=o._width,c=o._height,f=o._margin,h=e.length,u=0,y=Object(p.a)(n);try{for(y.s();!(l=y.n()).done;)for(var x=l.value,g=x.interval,v=0;v<x.seasonal.length;v++)h=Math.max(0,Math.min(h,x.seasonal[v].start-Math.floor(g/2))),u=Math.min(e.length,Math.max(u,x.seasonal[v].end+Math.floor(g/2)))}catch(C){y.e(C)}finally{y.f()}e=e.slice(h,u);var m=this.initSvg(s,f),w=m.append("g").attr("class","lineLayer"),k=m.append("g").attr("class","tooltip"),b=this.drawXAxis(m,e,r,d,c,s),_=b._x,O=b._axisX,A=b._tick_format,F=this.drawYAxis(m,e,a,s,c),P=this.drawBackLine(_,F,e,w,r,i,s),S=P._rawPath,B=P._lineGen,E=this.drawSeasonality(_,e,r,n,c,k,O,B,h);return this._showTooltip&&(Y("#whole-container",S,_,F,c,e,r,i,A,k),M("#whole-container",A,e,r,E,n[0],_,i)),m}}},{key:"parseFact",value:function(){var t=this.factdata(),e=this.measure(),a=this.breakdown(),r=this.focus(),n=t=t.sort((function(t,e){return x(t[a[0].field])-x(e[a[0].field])})),i="count"===e[0].aggregate?"COUNT":e[0].field;return{_data:n,_measure:e,_breakdown:a,_focus:r,_measureName:i}}},{key:"setChartStandard",value:function(){var t={width:600,height:280},e={top:15,right:20,bottom:15,left:20};return{_width:t.width-e.left-e.right,_height:t.height-e.top-e.bottom,_chartSize:t,_margin:e}}},{key:"initSvg",value:function(t,e){return d.w(this.container()).append("svg").attr("width",t.width).attr("height",t.height).append("g").attr("transform","translate("+(e.left+10)+","+e.top+")").attr("font-family","OPPOSans")}},{key:"drawXAxis",value:function(t,e,a,r,n,i){var l=d.u().range([0,r]);l.domain(d.i(e,(function(t){return x(t[a[0].field])})));var o=v(e[0][a[0].field]),s=g(e[0][a[0].field]),c=d.b(l).tickFormat(s);return o===d.E&&c.ticks(o),t.append("g").attr("class","xAxis").attr("transform","translate(0,"+(n-20)+")").call(c).call((function(t){t.attr("font-size","10px"),t.attr("font-family","OPPOSans"),t.attr("font-weight","lighter");var e=t.selectAll(".domain").attr("d");e=(e=e.replace("6V",6*i.height/320+"V")).replace("V6","V"+6*i.height/320),t.selectAll(".domain").attr("d",e).attr("stroke-width",2),t.selectAll(".tick").selectAll("line").attr("stroke","#000000").attr("stroke-width",2).attr("y2",5),t.selectAll("text").attr("y",10)})),{_x:l,_axisX:c,_tick_format:s}}},{key:"drawYAxis",value:function(t,e,a,r,n){var i=d.t().range([n-20,0]);return i.domain(C(e,a[0].field)),t.append("g").attr("class","yAxis").call(d.c(i).ticks(5).tickFormat((function(t){return t/1e6>=1?t=t/1e6+"M":t/1e3>=1&&(t=t/1e3+"K"),t}))).call((function(t){t.attr("font-size","10px"),t.attr("font-weight","lighter"),t.attr("font-family","OPPOSans");var e=t.selectAll(".domain").attr("d");e=(e=e.replace("M-6","M-"+6*r.width/640)).replace("H-6","H-"+6*r.width/640),t.selectAll(".domain").attr("d",e).attr("stroke-width",2),t.selectAll(".tick").select("line").attr("stroke","#000000").attr("stroke-width",2).attr("x2",-5),t.selectAll("text").attr("x",-10)})),i}},{key:"drawBackLine",value:function(t,e,a,r,n,i,l){r.append("g").selectAll("line.line").data(e.ticks(5)).enter().append("line").attr("x1",0).attr("x2",l.width).attr("y1",(function(t){return e(t)})).attr("y2",(function(t){return e(t)})).attr("stroke","#E6E6E6").attr("stroke-width","2px");var o=d.l().curve(d.g).x((function(e){return t(x(e[n[0].field]))})).y((function(t){return e(t[i])}));return{_rawPath:r.append("path").attr("d",o(a)).attr("stroke","#808080").attr("stroke-width","5px").attr("fill","none"),_lineGen:o}}},{key:"drawSeasonality",value:function(t,e,a,r,n,i,l,o,s){var d,c=[],f=[],h=Object(p.a)(r);try{for(h.s();!(d=h.n()).done;)for(var u=d.value,y=0;y<u.seasonal.length;y++){var g=u.seasonal[y],v=g.start-s,m=g.end-s;if(0===y&&v>0){var w=t(x(e[v][a[0].field]));i.append("line").attr("x1",w).attr("y1",0).attr("x2",w).attr("y2",n-20).attr("stroke-width","1px").attr("stroke","black").attr("stroke-dasharray","6, 3"),f.push(x(e[v][a[0].field]))}if(y<u.seasonal.length-1||m<e.length-1){var k=t(x(e[m][a[0].field]));i.append("line").attr("x1",k).attr("y1",0).attr("x2",k).attr("y2",n-20).attr("stroke-width","1px").attr("stroke","black").attr("stroke-dasharray","6, 3"),f.push(x(e[m][a[0].field]))}g.seasonal&&c.push(i.append("path").attr("d",o(e.slice(v,m+1))).attr("stroke","#6C8EF2").attr("stroke-width","5px").attr("fill","none"))}}catch(b){h.e(b)}finally{h.f()}return l.tickValues(f),c}}]),a}(y),M=function(t,e,a,r,n,i,l,o){var s=B(),c=d.d((function(t){return x(t[r[0].field])})).left,f=d.w(t).append("div").attr("id","hover-tooltip").style("z-index",2e3).style("width","200px").style("height","115px").style("opacity",0).style("position","absolute").style("pointer-events","none").style("padding-left","10px"),h=f.append("div").style("display","flex").style("align-items","center").style("height","15px").style("width","190px").style("border","2px solid ".concat("#3E3A39")).style("border-radius","4px 4px 0px 0px").style("padding-left","5px").style("padding-right","5px").style("background","#3E3A39").style("font","7px ".concat("OPPOSans")).style("font-weight","bold").style("color","#FCFBE7").style("text-overflow","ellipsis").style("overflow","hidden").style("white-space","nowrap"),u=f.append("div").style("width","200px").style("height","100px").style("border","2px solid ".concat("#3E3A39")).style("border-radius","0px 4px 4px 4px").style("background","#FCFBE7");u.append("span").style("position","absolute").style("left","-10px").style("top","60px").style("border-width","10px").style("border-style","dashed solid dashed dashed").style("border-color","transparent ".concat("#3E3A39"," transparent transparent")).style("font-size",0).style("line-height",0),u.append("em").style("position","absolute").style("left","-4px").style("top","62px").style("border-width","8px").style("border-style","dashed solid dashed dashed").style("border-color","transparent ".concat("#FCFBE7"," transparent transparent")).style("font-size",0).style("line-height",0),u.append("div").attr("id","tooltip-chart"+s);var y=d.t().range([10,190]),g=d.t().range([90,10]),v=d.l().curve(d.g).x((function(t){return y(t.x)})).y((function(t){return g(t.y)})),w=d.t().range([90,10]);w.domain(C(i.average));for(var k,b=d.l().curve(d.g).x((function(t){return y(t.x)})).y((function(t){return w(t.y)})),_=(k=x(a[i.interval][r[0].field])-x(a[0][r[0].field]))/1e3<1?k+" ms":k/6e4<1?(k/1e3).toFixed(1)+" s":k/36e5<1?(k/6e4).toFixed(1)+" min(s)":k/m<1?(k/36e5).toFixed(1)+" hour(s)":k/6048e5<1?(k/m).toFixed(1)+" day(s)":k/2592e6<1?(k/6048e5).toFixed(1)+" week(s)":k/31536e6<1?(k/2592e6).toFixed(1)+" month(s)":(k/31536e6).toFixed(1)+" year(s)",O=0;O<n.length;O++){n[O].on("mouseover",(function(t){f.transition().duration(200).style("opacity",.9)})).on("mouseout",(function(t){f.transition().duration(500).style("opacity",0)})).on("mousemove",(function(t){var n=d.o(this)[0],u=d.o(this)[1],m=l.invert(d.o(this)[0]),w=c(a,m,1),k=Math.floor(w/i.interval)*i.interval,O=k+i.interval-1,A=e(x(a[k][r[0].field]))+"-"+e(x(a[O][r[0].field]));f.style("left",n+30+"px").style("top",u-50+"px");var F=d.w("#tooltip-chart"+s).node().getElementsByTagName("svg")[0];if(!F||F.getAttribute("class")!==A){h.html(A),d.w("#tooltip-chart"+s).selectAll("*").remove();for(var P=Math.floor(w/i.interval),S=[],B=P<=2?0:k-2*i.interval,E=P+3+1>=a.length/i.interval?a.length:O+3*i.interval,M=B;M<E;M++)S.push({x:M-B,y:a[M][o]});y.domain([0,E-B+1]),g.domain(C(S,"y"));var Y=d.w("#tooltip-chart"+s).append("svg").attr("class",A).attr("width","200").attr("height","100").append("g");Y.append("rect").style("width",y(O-B)-y(k-B)).style("height","70px").style("fill","#ffffff").style("x",y(k-B)).style("y","20px");for(var T=0;T<=(E-B)/i.interval;T++){var z=y(T*i.interval);Y.append("line").attr("x1",z).attr("y1",20).attr("x2",z).attr("y2",90).attr("stroke-width","1px").attr("stroke","black")}Y.append("path").attr("d",v(S)).attr("stroke","#808080").attr("stroke-width","2px").attr("fill","none");var j,D=Object(p.a)(i.seasonal);try{for(D.s();!(j=D.n()).done;){var N=j.value,I=Math.max(N.start,B)-B,V=Math.min(N.end,E)-B;if(!(V<0)){for(var H=0;H<(V-I)/i.interval;H++){for(var L=[],R=0;R<i.average.length;R++)L.push({x:I+H*i.interval+R,y:i.average[R]});Y.append("path").attr("d",b(L)).attr("stroke","#FFBB8A").attr("stroke-width","2px").attr("stroke-dasharray","6, 3").attr("fill","none")}Y.append("path").attr("d",v(S.slice(I,V+1))).attr("stroke","#6C8EF2").attr("stroke-width","3px").attr("fill","none")}}}catch(X){D.e(X)}finally{D.f()}var U=Y.append("g").style("font-size","6px").style("font-weight","bold").style("font-family","OPPOSans").style("color","#3E3A39");U.append("line").attr("x1","6px").attr("y1","8px").attr("x2","21px").attr("y2","8px").attr("stroke-width","2px").attr("stroke","#FFBB8A").attr("stroke-dasharray","6, 3").attr("fill","none"),U.append("text").attr("x","25px").attr("y","10px").text("Seasonality"),U.append("text").attr("x","135px").attr("y","10px").text("Interval "+_)}}))}},Y=function(t,e,a,r,n,i,l,o,s,c){var p=d.w(t).append("div").attr("id","value-tooltip").style("z-index",2e3).style("width","fit-content").style("height","40px").style("opacity",0).style("position","absolute").style("pointer-events","none").style("border-radius","4px").style("background","#FFFFFF").style("box-shadow","0 0 5px #888888").style("padding","5px"),f=p.append("span").style("font","9px ".concat("OPPOSans")).style("font-weight","bold").style("display","block").style("color","#000000"),h=p.append("svg").attr("width","95px").attr("height","30px"),u=h.append("circle").attr("r",4).attr("cx","5px").attr("cy","12px"),y=h.append("text").style("font","8px ".concat("OPPOSans")).style("color","#000000").attr("x","14px").attr("y","14px");e.on("mouseover",(function(t){p.transition().duration(200).style("opacity",.9),v.transition().duration(200).style("opacity",1)})).on("mouseout",(function(t){document.elementFromPoint(d.h.pageX,d.h.pageY)!==w.node()&&(p.transition().duration(500).style("opacity",0),v.transition().duration(500).style("opacity",0))})).on("mousemove",(function(t){var e=d.o(this)[0],n=d.o(this)[1],c=a.invert(d.o(this)[0]),h=g(i,c,1),v=x(i[h-1][l[0].field]),k=x(i[h][l[0].field]),b=c-v>k-c?k:v,_=b===v?i[h-1][o]:i[h][o],O=s(b);p.style("left",e+30+"px").style("top",n+20+"px"),f.html(O),u.style("fill","#808080"),y.html(o+": "+_.toFixed(2)),m.attr("x1",a(b)),m.attr("x2",a(b)),w.attr("cx",a(b)),w.attr("cy",r(_)),w.attr("stroke","#808080")}));var g=d.d((function(t){return x(t[l[0].field])})).left,v=c.append("g").style("opacity",0),m=v.append("line").attr("y1",n-20).attr("y2",0).attr("stroke-width","2px").attr("stroke","#E6E6E6").attr("stroke-dasharray","6, 3"),w=v.append("circle").attr("r",3).attr("fill","#FFFFFF").attr("stroke-width","2").style("box-shadow","0 0 5px #888888").on("mouseover",(function(t){p.transition().duration(200).style("opacity",.9),v.transition().duration(200).style("opacity",1)})).on("mouseout",(function(t){p.transition().duration(500).style("opacity",0),v.transition().duration(500).style("opacity",0)}))},C=function(t,e){var a=d.m(t.map((function(t){return void 0===e?t:t[e]}))),r=d.n(t.map((function(t){return void 0===e?t:t[e]})));return[r+.2*(r-a),a-.2*(r-a)]},T=E,z=["#6C8EF2","#E1944E","#8B65BA"],j=function(t){Object(i.a)(a,t);var e=Object(l.a)(a);function a(){var t;return Object(r.a)(this,a),(t=e.call(this))._x="",t._y="",t}return Object(n.a)(a,[{key:"display",value:function(){var t=this.factdata(),e=this.breakdown(),a=this.focus(),r=[],n=t.sort((function(t,a){return x(t[e[0].field])-x(a[e[0].field])}));if(0!==a.length){var i,l=550,o=440,s=15,c=60,f=this.container(),h=d.w(f).append("svg").attr("width",l).attr("height",o).append("g").attr("transform","translate("+(c+10)+","+s+")").attr("font-family","OPPOSans"),u=[],y=[],m=[],w=[],k=[],b=[],_=[],O=[],A=Object(p.a)(a);try{for(A.s();!(i=A.n()).done;){var F=i.value;O.includes(F.field)||(O.push(F.field),r.push({field:F.field}))}}catch(N){A.e(N)}finally{A.f()}var P,S=Math.floor(l/r.length),B=Math.floor(o/r.length),E=Object(p.a)(a);try{for(E.s();!(P=E.n()).done;)for(var M=P.value,Y=0;Y<r.length;Y++)M.field===r[Y].field&&("mean"===M.name?u[Y]=M.value:"std"===M.name?y[Y]=M.value:"a"===M.name?m[Y]=M.value:"b"===M.name?w[Y]=M.value:"rad"===M.name?k[Y]=M.value:"min"===M.name?b[Y]=M.value:"max"===M.name&&(_[Y]=M.value))}catch(N){E.e(N)}finally{E.f()}for(var C=h.append("g").attr("class","tooltip"),T=function(t){for(var a=function(a){var i=S*t,o=B*a;if(t===a){var s=d.u().range([i,i+S/2]),c=d.t().range([o+S/2,o]);s.domain(d.i(n,(function(t){return x(t[e[0].field])}))),c.domain(d.i([].concat(n.map((function(e){return.95*e[r[t].field]})),n.map((function(e){return 1.05*e[r[t].field]})))));var p=v(n[0][e[0].field]),f=g(n[0][e[0].field]),O=d.b(s).tickFormat(f);p===d.E&&O.ticks(p);var A=u[t],F=[A-2*y[t],A+2*y[t]],P=b[t],E=_[t],M=s(x(n[0][e[0].field])),Y=s(x(n[n.length-1][e[0].field]));h.append("rect").attr("x",M).attr("y",c(F[1])).attr("width",Y-M).attr("height",c(F[0])-c(F[1])).attr("fill","#8ED9AB").attr("opacity",.3),h.append("g").attr("class","lineLayer").append("g").selectAll("line.line").data(c.ticks(5)).enter().append("line").attr("x1",i).attr("x2",i+S/2).attr("y1",(function(t){return c(t)})).attr("y2",(function(t){return c(t)})).attr("stroke","#E6E6E6").attr("stroke-width","2px"),C.append("line").attr("x1",M).attr("y1",c(P)).attr("x2",Y).attr("y2",c(P)).attr("stroke-width","1px").attr("stroke","black").attr("stroke-dasharray","6px"),C.append("line").attr("x1",M).attr("y1",c(E)).attr("x2",Y).attr("y2",c(E)).attr("stroke-width","1px").attr("stroke","black").attr("stroke-dasharray","6px");var T=h.append("g").attr("class","lineLayer"),j=d.l().curve(d.g).x((function(t){return s(x(t[e[0].field]))})).y((function(e){return c(e[r[t].field])}));T.append("path").attr("d",j(n)).attr("stroke","#6C8EF2").attr("stroke-width","1px").attr("fill","none");var N=[];N.push(x(n[10][e[0].field])),N.push(x(n[n.length-10][e[0].field])),O.tickValues(N);var I=h.append("g").attr("class","tooltip"),V=I.append("text").attr("font-size","5.5px").attr("font-family","OPPOSans").attr("fill","#000000");V.append("tspan").text("Min: "+P).attr("dy",.9*V.selectAll("tspan").node().getBBox().height);var H=V.node().getBBox().width,L=1.5*V.node().getBBox().height;V.attr("width",H).attr("height",L).attr("x",Y-H).attr("y",c(P)-L),(V=I.append("text").attr("font-size","5.5px").attr("font-family","OPPOSans").attr("font-weight","light").attr("fill","#000000")).append("tspan").text("Max: "+E).attr("dy",.9*V.selectAll("tspan").node().getBBox().height),H=V.node().getBBox().width,L=1.5*V.node().getBBox().height,V.attr("width",H).attr("height",L).attr("x",Y-H).attr("y",c(E)-L),I.append("line").attr("x1",M).attr("y1",c(A)).attr("x2",Y).attr("y2",c(A)).attr("stroke-width","1px").attr("stroke","black"),(V=I.append("text").attr("font-size","5.5px").attr("font-family","OPPOSans").attr("font-weight","light").attr("fill","#000000")).append("tspan").text("Avg: "+A).attr("dy",.9*V.selectAll("tspan").node().getBBox().height),H=V.node().getBBox().width,L=1.5*V.node().getBBox().height,h.append("rect").attr("x",Y-H).attr("y",c(A)-1.15*L).attr("width",H).attr("height",L).attr("fill","white").attr("opacity",.8),V.attr("width",H).attr("height",L).attr("x",Y-H).attr("y",c(A)-L);var R=h.append("g").attr("class","tooltip").style("background-color","white").style("opacity",.8).append("text").attr("font-size","5.5px").attr("font-family","OPPOSans").attr("fill","#000000");R.append("tspan").text("Avg: "+A).attr("dy",.9*R.selectAll("tspan").node().getBBox().height),R.attr("width",H).attr("height",L).attr("x",Y-H).attr("y",c(A)-L),h.append("g").attr("class","xAxis").attr("transform","translate(0,"+(o+S/2)+")").call(O).call((function(t){t.attr("font-size","8px"),t.attr("font-family","OPPOSans"),t.attr("font-weight","light");var e=t.selectAll(".domain").attr("d");e=(e=e.replace("M-6","M-"+6*l/640)).replace("H-6","H-"+6*l/640),t.selectAll(".domain").attr("d",e).attr("stroke-width",2),t.selectAll(".tick").selectAll("line").attr("stroke","#000000").attr("stroke-width",2).attr("y2",5),t.selectAll("text").attr("y",10)}));var U=h.append("g").attr("class","yAxis");U.attr("transform","translate("+i+",0)").call(d.c(c).ticks(5).tickFormat((function(t){return t/1e6>=1?t=t/1e6+"M":t/1e3>=1&&(t=t/1e3+"K"),t}))).call((function(t){t.attr("font-size","8px"),t.attr("font-weight","light"),t.attr("font-family","OPPOSans");var e=t.selectAll(".domain").attr("d");e=(e=e.replace("M-6","M-"+6*l/640)).replace("H-6","H-"+6*l/640),t.selectAll(".domain").attr("d",e).attr("stroke-width",2),t.selectAll(".tick").select("line").attr("stroke","#000000").attr("stroke-width",2).attr("x2",-5),t.selectAll("text").attr("x",-10)})),U.append("text").attr("transform","rotate(-90)").attr("y",-35).attr("x",0-o-45).style("text-anchor","middle").style("font-size","10px").attr("font-weight","heavy").attr("fill",z[t]).text(D(r[t].field))}else{var X=d.t().range([i,i+S/2]),G=d.t().range([o+S/2,o]);X.domain(d.i([].concat(n.map((function(e){return.95*e[r[t].field]})),n.map((function(e){return 1.05*e[r[t].field]}))))),G.domain(d.i([].concat(n.map((function(t){return.95*t[r[a].field]})),n.map((function(t){return 1.05*t[r[a].field]})))));var K;u[t],u[a],b[t],b[a],_[t],_[a];0===t&&1===a||1===t&&0===a?K=0:0===t&&2===a||2===t&&0===a?K=1:(1===t&&2===a||2===t&&1===a)&&(K=2),t<a?(m[K],w[K],-k[K]):(w[K],m[K],k[K]-180),h.append("g").selectAll("circle").data(n).enter().append("circle").attr("cx",(function(e){return X(e[r[t].field])})).attr("cy",(function(t){return G(t[r[a].field])})).attr("r","2.5px").attr("fill","#F28AB3");var Z=h.append("g").attr("class","xAxis");Z.attr("transform","translate(0,"+(o+S/2)+")").call(d.b(X).ticks(3).tickFormat((function(t){return t/1e6>=1?t=t/1e6+"M":t/1e3>=1&&(t=t/1e3+"K"),t}))).call((function(t){t.attr("font-size","8px"),t.attr("font-family","OPPOSans"),t.attr("font-weight","light");var e=t.selectAll(".domain").attr("d");e=(e=e.replace("M-6","M-"+6*l/640)).replace("H-6","H-"+6*l/640),t.selectAll(".domain").attr("d",e).attr("stroke-width",2),t.selectAll(".tick").selectAll("line").attr("stroke","#000000").attr("stroke-width",2).attr("y2",5),t.selectAll("text").attr("y",10)}));var q=h.append("g").attr("class","yAxis");q.attr("transform","translate("+i+",0)").call(d.c(G).ticks(5).tickFormat((function(t){return t/1e6>=1?t=t/1e6+"M":t/1e3>=1&&(t=t/1e3+"K"),t}))).call((function(t){t.attr("font-size","8px"),t.attr("font-weight","light"),t.attr("font-family","OPPOSans");var e=t.selectAll(".domain").attr("d");e=(e=e.replace("M-6","M-"+6*l/640)).replace("H-6","H-"+6*l/640),t.selectAll(".domain").attr("d",e).attr("stroke-width",2),t.selectAll(".tick").select("line").attr("stroke","#000000").attr("stroke-width",2).attr("x2",-5),t.selectAll("text").attr("x",-10)}));Z.append("text").attr("y",30).attr("x",i+45).style("text-anchor","middle").style("font-size","10px").attr("fill",z[t]).text(D(r[t].field));q.append("text").attr("transform","rotate(-90)").attr("y",-35).attr("x",0-o-45).style("text-anchor","middle").style("font-size","10px").attr("fill",z[a]).text(D(r[a].field))}},i=0;i<=r.length-1;i++)a(i)},j=0;j<=r.length-1;j++)T(j);return h}}}]),a}(y),D=function(t){return t.length>16?t.slice(0,16)+"...":t},N=j,I=function(t){Object(i.a)(a,t);var e=Object(l.a)(a);function a(){var t;return Object(r.a)(this,a),(t=e.call(this))._x="",t._y="",t.tooltipId=B(),t}return Object(n.a)(a,[{key:"display",value:function(){var t=this.parseFact(),e=t._data,a=t._measure,r=t._breakdown,n=t._focus,i=t._measureName;if(0!==n.length&&(!r[1]||!r[1].field)){var l=this.setChartStandard(),o=l._chartSize,s=l._width,c=l._height,p=l._margin,f=this.initSvg(o,p),h=f.append("g").attr("class","lineLayer"),u=f.append("g").attr("class","tooltip"),y=d.u().range([0,s]);y.domain(d.i(e,(function(t){return x(t[r[0].field])})));var m=v(e[0][r[0].field]),w=g(e[0][r[0].field]),k=d.b(y).tickFormat(w);m===d.E&&k.ticks(m);var b=d.t().range([c-20,0]);b.domain(d.i([].concat(e.map((function(t){return.95*t[a[0].field]})),e.map((function(t){return 1.05*t[a[0].field]})))));var _=this.drawBackLine(y,b,e,h,r,i,o),O=_._rawPath,A=_._lineGen,F=this.drawFrequentPattern(y,b,e,r,n,i,u,c,k,A);return this._showTooltip&&(H("#whole-container",O,y,b,c,e,r,i,w,u),V(this.tooltipId,"#whole-container",w,e,r,F,n)),f.append("g").attr("class","xAxis").attr("transform","translate(0,"+(c-20)+")").call(k).call((function(t){t.attr("font-size","10px"),t.attr("font-family","OPPOSans"),t.attr("font-weight","lighter");var e=t.selectAll(".domain").attr("d");e=(e=e.replace("6V",6*o.height/320+"V")).replace("V6","V"+6*o.height/320),t.selectAll(".domain").attr("d",e).attr("stroke-width",2),t.selectAll(".tick").selectAll("line").attr("stroke","#000000").attr("stroke-width",2).attr("y2",5),t.selectAll("text").attr("y",10)})),f.append("g").attr("class","yAxis").call(d.c(b).ticks(5).tickFormat((function(t){return t/1e6>=1?t=t/1e6+"M":t/1e3>=1&&(t=t/1e3+"K"),t}))).call((function(t){t.attr("font-size","10px"),t.attr("font-weight","lighter"),t.attr("font-family","OPPOSans");var e=t.selectAll(".domain").attr("d");e=(e=e.replace("M-6","M-"+6*o.width/640)).replace("H-6","H-"+6*o.width/640),t.selectAll(".domain").attr("d",e).attr("stroke-width",2),t.selectAll(".tick").select("line").attr("stroke","#000000").attr("stroke-width",2).attr("x2",-5),t.selectAll("text").attr("x",-10)})),f}}},{key:"parseFact",value:function(){var t=this.factdata(),e=this.measure(),a=this.breakdown(),r=this.focus(),n=t=t.sort((function(t,e){return x(t[a[0].field])-x(e[a[0].field])})),i="count"===e[0].aggregate?"COUNT":e[0].field;return{_data:n,_measure:e,_breakdown:a,_focus:r,_measureName:i}}},{key:"setChartStandard",value:function(){var t={width:600,height:280},e={top:15,right:20,bottom:15,left:20};return{_width:t.width-e.left-e.right,_height:t.height-e.top-e.bottom,_chartSize:t,_margin:e}}},{key:"initSvg",value:function(t,e){return d.w(this.container()).append("svg").attr("width",t.width).attr("height",t.height).append("g").attr("transform","translate("+(e.left+10)+","+e.top+")").attr("font-family","OPPOSans")}},{key:"drawBackLine",value:function(t,e,a,r,n,i,l){r.append("g").selectAll("line.line").data(e.ticks(5)).enter().append("line").attr("x1",0).attr("x2",l.width).attr("y1",(function(t){return e(t)})).attr("y2",(function(t){return e(t)})).attr("stroke","#E6E6E6").attr("stroke-width","2px");var o=d.l().curve(d.g).x((function(e){return t(x(e[n[0].field]))})).y((function(t){return e(t[i])}));return{_rawPath:r.append("path").attr("d",o(a)).attr("stroke","#6C8EF2").attr("stroke-width","2px").attr("fill","none"),_lineGen:o}}},{key:"drawFrequentPattern",value:function(t,e,a,r,n,i,l,o,s,c){var f,h=[],u=[],y=Object(p.a)(n[0].patterns);try{for(y.s();!(f=y.n()).done;){var g=f.value,v=t(x(a[g.start][r[0].field])),m=t(x(a[g.end-1][r[0].field])),w=d.n(a.slice(g.start,g.end+1),(function(t){return e(t[i])}));l.append("line").attr("x1",v).attr("y1",e(a[g.start][i])).attr("x2",v).attr("y2",o-20).attr("stroke-width","2px").attr("stroke","black").attr("stroke-dasharray","6, 3"),l.append("line").attr("x1",m).attr("y1",e(a[g.end][i])).attr("x2",m).attr("y2",o-20).attr("stroke-width","2px").attr("stroke","black").attr("stroke-dasharray","6, 3"),u.push(l.append("path").attr("d",c(a.slice(g.start,g.end+1))).attr("stroke","#FFC111").attr("stroke-width","3px").attr("fill","none"));var k=l.append("text").attr("font-size","14px").attr("font-family","OPPOSans").attr("font-weight","bold").attr("fill","#FFC111");k.append("tspan").text(g.name).attr("dy",.9*k.selectAll("tspan").node().getBBox().height);var b=k.node().getBBox().width,_=k.node().getBBox().height;k.attr("width",b).attr("height",_).attr("x",(v+m-b+10)/2).attr("y",w-_-10),h.push(x(a[g.start][r[0].field])),h.push(x(a[g.end][r[0].field]))}}catch(O){y.e(O)}finally{y.f()}return s.tickValues(h),u}}]),a}(y),V=function(t,e,a,r,n,i,l){var o=d.w(e).append("div").attr("id","hover-tooltip").style("z-index",2e3).style("width","200px").style("height","115px").style("opacity",0).style("position","absolute").style("pointer-events","none").style("padding-left","10px"),s=o.append("div").style("align-items","center").style("height","15px").style("width","100px").style("border","2px solid ".concat("#3E3A39")).style("border-radius","4px 4px 0px 0px").style("padding-left","5px").style("padding-right","5px").style("background","#3E3A39").style("font","8px ".concat("OPPOSans")).style("font-weight","bold").style("color","#FCFBE7").style("text-overflow","ellipsis").style("overflow","hidden").style("white-space","nowrap"),c=o.append("div").style("width","200px").style("height","100px").style("border","2px solid ".concat("#3E3A39")).style("border-radius","0px 4px 4px 4px").style("background","#FCFBE7");c.append("span").style("position","absolute").style("left","-10px").style("top","60px").style("border-width","10px").style("border-style","dashed solid dashed dashed").style("border-color","transparent ".concat("#3E3A39"," transparent transparent")).style("font-size",0).style("line-height",0),c.append("em").style("position","absolute").style("left","-4px").style("top","62px").style("border-width","8px").style("border-style","dashed solid dashed dashed").style("border-color","transparent ".concat("#FCFBE7"," transparent transparent")).style("font-size",0).style("line-height",0),c.append("div").attr("id","tooltip-chart"+t);for(var p=d.t().range([0,195]),f=d.t().range([90,0]),h=d.l().curve(d.g).x((function(t){return p(t.x)})).y((function(t){return f(t.y)})),u=function(){for(var e=l[0].patterns[y],c=i[y],u=[],g=[],v=0;v<e.normalized.length;v++)u.push({x:v,y:e.normalized[v]}),g.push({x:v,y:l[0].average[v]});p.domain([0,e.normalized.length-1]),f.domain(d.i([].concat(u.map((function(t){return.9*t.y})),u.map((function(t){return 1.1*t.y}))))),c.on("mouseover",(function(t){o.transition().duration(200).style("opacity",.9)})).on("mouseout",(function(t){o.transition().duration(500).style("opacity",0)})).on("mousemove",(function(i){var l=b(),c=a(x(r[e.start][n[0].field]))+"-"+a(x(r[e.end][n[0].field]));if(o.style("left",l.posX+30+"px").style("top",l.posY-50+"px"),null!==d.w("#tooltip-chart"+t).node()){var p=d.w("#tooltip-chart"+t).node().getElementsByTagName("svg")[0];if(!p||p.getAttribute("class")!==c){s.html(c),d.w("#tooltip-chart"+t).selectAll("*").remove();var f=d.w("#tooltip-chart"+t).append("svg").attr("class",c).attr("width","200").attr("height","100").append("g");f.append("path").attr("d",h(u)).attr("stroke","#FFC111").attr("stroke-width","3px").attr("fill","none"),f.append("path").attr("d",h(g)).attr("stroke","#D2CFFD").attr("stroke-width","3px").attr("fill","none");var y=f.append("g").style("font-size","6px").style("font-weight","bold").style("font-family","OPPOSans").style("color","#3E3A39");y.append("rect").style("width","15px").style("height","5px").style("fill","#FFC111").style("x","6px").style("y","6px"),y.append("rect").style("width","15px").style("height","5px").style("fill","#D2CFFD").style("x","6px").style("y","89px"),y.append("text").attr("x","25px").attr("y","10px").text("Selected"),y.append("text").attr("x","25px").attr("y","93px").text("Avg.")}}}))},y=0;y<i.length;y++)u()},H=function(t,e,a,r,n,i,l,o,s,c){var p=d.w(t).append("div").attr("id","value-tooltip").style("z-index",2e3).style("width","fit-content").style("height","40px").style("opacity",0).style("position","absolute").style("pointer-events","none").style("border-radius","4px").style("background","#FFFFFF").style("box-shadow","0 0 5px #888888").style("padding","5px"),f=p.append("span").style("font","9px ".concat("OPPOSans")).style("font-weight","bold").style("display","block").style("color","#000000"),h=p.append("svg").attr("width","95px").attr("height","30px"),u=h.append("circle").attr("r",4).attr("cx","5px").attr("cy","12px"),y=h.append("text").style("font","8px ".concat("OPPOSans")).style("color","#000000").attr("x","14px").attr("y","14px");e.on("mouseover",(function(t){p.transition().duration(200).style("opacity",.9),v.transition().duration(200).style("opacity",1)})).on("mouseout",(function(t){document.elementFromPoint(d.h.pageX,d.h.pageY)!==w.node()&&(p.transition().duration(500).style("opacity",0),v.transition().duration(500).style("opacity",0))})).on("mousemove",(function(t){var e=b(),n=a.invert(d.o(this)[0]),c=g(i,n,1),h=x(i[c-1][l[0].field]),v=x(i[c][l[0].field]),k=n-h>v-n?v:h,_=k===h?i[c-1][o]:i[c][o],O=s(k);p.style("left",e.posX+30+"px").style("top",e.posY+20+"px"),f.html(O),u.style("fill","#6C8EF2"),y.html(o+": "+_.toFixed(2)),m.attr("x1",a(k)),m.attr("x2",a(k)),w.attr("cx",a(k)),w.attr("cy",r(_)),w.attr("stroke","#6C8EF2")}));var g=d.d((function(t){return x(t[l[0].field])})).left,v=c.append("g").style("opacity",0),m=v.append("line").attr("y1",n-20).attr("y2",0).attr("stroke-width","2px").attr("stroke","#E6E6E6").attr("stroke-dasharray","6, 3"),w=v.append("circle").attr("r",3).attr("fill","#FFFFFF").attr("stroke-width","2").style("box-shadow","0 0 5px #888888").on("mouseover",(function(t){p.transition().duration(200).style("opacity",.9),v.transition().duration(200).style("opacity",1)})).on("mouseout",(function(t){p.transition().duration(500).style("opacity",0),v.transition().duration(500).style("opacity",0)}))},L=I,R=["#6C8EF2","#E1944E","#8B65BA"],U=function(t){Object(i.a)(a,t);var e=Object(l.a)(a);function a(){var t;return Object(r.a)(this,a),(t=e.call(this))._x="",t._y="",t}return Object(n.a)(a,[{key:"display",value:function(){var t=this.factdata(),e=this.breakdown(),a=this.focus(),r=t=t.sort((function(t,a){return G(t[e[0].field])-G(a[e[0].field])}));if(0!==a.length){for(var n=314,i=216,l=15,o=20,s=n-o-20,c=i-l-15,f=this.container(),h=d.w(this.container()).append("svg").attr("width",n).attr("height",i).append("g").attr("transform","translate("+(o+10)+","+l+")").attr("font-family","OPPOSans"),u=d.t().range([0,s]),y=d.t().range([c,10]),x=[],g=1,v=-1,m=0;m<a[0].cluster.length;m++){var w,k=Object(p.a)(a[0].cluster[m].position);try{for(k.s();!(w=k.n()).done;){var b=w.value;x.push({x:b[0],y:b[1],symbol:g})}}catch(et){k.e(et)}finally{k.f()}g++}for(var _=0;_<a[0].outlier.length;_++){var O,A=Object(p.a)(a[0].outlier[_].position);try{for(A.s();!(O=A.n()).done;){var F=O.value;x.push({x:F[0],y:F[1],symbol:v})}}catch(et){A.e(et)}finally{A.f()}v--}u.domain(d.i(x,(function(t){return t.x}))),y.domain(d.i(x,(function(t){return t.y})));var P=d.z.map((function(t){return d.x().size(18).type(t)()}));h.append("g").selectAll("path").data(x).join("path").attr("transform",(function(t){return"translate(".concat(u(t.x),", ").concat(y(t.y),")")})).attr("fill",(function(t){return t.symbol>0?"#74C8F8":"#F72D35"})).attr("d",(function(t){return t.symbol>0?P[t.symbol%P.length]:P[0]}));for(var S=h.append("g"),B=d.l().x((function(t){return t[0]})).y((function(t){return t[1]})).curve(d.f),E=function(t){var e=x.filter((function(e){return e.symbol===t})).map((function(t){return[u(t.x),y(t.y)]}));if(e.length>2){var a=d.r(e),r=d.q(a);S.append("g").attr("transform","translate("+r[0]+","+r[1]+") scale(2)").append("path").attr("d",(function(){return B(a.map((function(t){return[t[0]-r[0],t[1]-r[1]]})))})).attr("stroke","#000000").attr("stroke-width","0.5px").attr("fill","none")}},M=1;M<g;M++)E(M);for(var Y=function(t){var e,a,r,n=x.filter((function(e){return e.symbol===t}))[0],i=u(n.x),l=y(n.y),o=S.append("text").attr("font-size","10px").attr("font-family","OPPOSans").attr("font-weight","bold").attr("fill","#000000").attr("y",l+5).text("Outlier ".concat(-t)),d=o.node().getBBox().width;i>s/2?i+20>s?(e=-20-d,a=-17,r=-8):(e=20,a=17,r=8):i-d-20<0?(e=20,a=17,r=8):(e=-20-d,a=-17,r=-8),o.attr("x",i+e),S.append("line").attr("x1",i+a).attr("x2",i+r).attr("y1",l).attr("y2",l).attr("stroke","#000000").attr("stroke-width","1px")},C=-1;C>v;C--)Y(C);var T=d.w(f).append("div").style("position","absolute").style("left","318px").style("top","10px").style("font-size","8px").style("font-family","OPPOSans").attr("id","overviewTable"),z=d.w(f).append("div").style("position","absolute").style("left","10px").style("top","220").style("font-size","8px").style("font-family","OPPOSans");a[0].cluster.length>0&&X(1,z,P,a,r,e);for(var j=T.append("table").style("border","1px solid #000000").style("border-collapse","collapse").style("border-spacing",0).attr("width","300px"),D=j.append("thead").style("background","#eeee").append("tr").selectAll("th").data(["Cluster","Number of series","Similarity in cluster"]).enter().append("th").style("padding","5px 15px").text((function(t){return t})),N=D.node().getBoundingClientRect().width+30,I=j.append("tbody"),V=1;V<g;V++){var H=I.append("tr"),L=H.append("td").append("svg").attr("width",N).attr("height",12).append("g").attr("id",V),R=L.append("text").attr("font-size","8").attr("font-family","OPPOSans").attr("fill","#000000").text("Cluster ".concat(V)).node().getBBox().width;L.append("path").attr("transform","translate(".concat(R+8,", -3)")).attr("d",P[V%P.length]).attr("fill","#74C8F8"),R=L.node().getBBox().width;var U=L.node().getBBox().height;L.attr("transform","translate(".concat(N/2-R/2,", ").concat(U,")")).on("click",(function(t,n){X(d.w(this).attr("id"),z,P,a,r,e)})),H.append("td").text("".concat(a[0].cluster[V-1].position.length)).style("text-align","center"),(L=H.append("td").append("svg").attr("width",N).attr("height",12).append("g")).append("rect").attr("x",0).attr("y",2).attr("width",70).attr("height",10).attr("fill","#f3f3f3"),L.append("rect").attr("x",0).attr("y",2).attr("width",70*a[0].cluster[V-1].score).attr("height",10).attr("fill","#74C8F8"),L.append("text").attr("x",75).attr("y",10).text(a[0].cluster[V-1].score.toFixed(2))}var K=(T=d.w(f).append("div").style("position","absolute").style("left","318px").style("top","108px").style("font-size","8px").style("font-family","OPPOSans")).append("table").style("border","1px solid #000000").style("border-collapse","collapse").style("border-spacing",0).attr("width","300px");N=(D=K.append("thead").style("background","#eeee").append("tr").selectAll("th").data(["Outlier","Anomaly score"]).enter().append("th").style("padding","3px 15px").text((function(t){return t}))).node().getBoundingClientRect().width+30;for(var Z=K.append("tbody"),q=-1;q>v;q--){var Q=Z.append("tr"),J=Q.append("td").append("svg").attr("width",N).attr("height","12").append("g"),W=J.append("text").attr("font-size","8").attr("font-family","OPPOSans").attr("fill","#000000").text("Outlier ".concat(-q)),$=W.node().getBBox().width;J.append("path").attr("transform","translate(".concat($+8,", -3)")).attr("d",P[0]).attr("fill","#F72D35"),$=J.node().getBBox().width;var tt=W.node().getBBox().height;J.attr("transform","translate(".concat(N/2-$/2,", ").concat(tt,")")),(J=Q.append("td").append("svg").attr("width",N).attr("height",12).append("g").attr("transform","translate(25, 0)")).append("rect").attr("x",0).attr("y",2).attr("width",70).attr("height",10).attr("fill","#f3f3f3"),J.append("rect").attr("x",0).attr("y",2).attr("width",70*a[0].outlier[-q-1].score).attr("height",10).attr("fill","#F72D35"),J.append("text").attr("x",75).attr("y",10).text(a[0].outlier[-q-1].score.toFixed(2))}return h}}}]),a}(y),X=function(t,e,a,r,n,i){e.selectAll("*").remove();var l=e.append("table").style("border","1px solid #000000").style("border-collapse","collapse").style("border-spacing",0).attr("width","600px"),o=l.append("thead").style("background","#eeee").style("text-align","left").append("tr").append("th").style("padding","3px 15px").attr("colspan",2).append("svg").attr("width",100).attr("height",12).append("g"),s=o.append("text").attr("font-size","8").attr("font-family","OPPOSans").attr("fill","#000000").text("Overview: Cluster ".concat(t)),c=s.node().getBBox().width;o.append("path").attr("transform","translate(".concat(c+8,", -3)")).attr("d",a[t]).attr("fill","#74C8F8"),c=o.node().getBBox().width;var f=s.node().getBBox().height;o.attr("transform","translate(5, ".concat(f,")"));for(var h=l.append("tbody"),u=function(){var e=r[0].variable[y].name,a=h.append("tr"),l=a.append("td").style("border","1px solid #000000").style("width","50px"),o=l.append("svg").attr("width",50).attr("height",30).append("g"),s=o.append("text").style("font-size","8px").text(e);o.append("rect").attr("x",s.node().getBBox().x).attr("y",s.node().getBBox().y).attr("width",s.node().getBBox().width).attr("height",s.node().getBBox().height).attr("fill",R[y%R.length]);var c=s.node().getBBox().width;s.node().remove(),o.append("text").style("font-size","8px").text(e),o.attr("transform","translate(".concat(25-c/2,", 18)")),l=a.append("td").style("border","1px solid #000000").style("width","550px"),o=l.append("svg").attr("width",550).attr("height",30).append("g");var f,u=new Map,x=Object(p.a)(r[0].cluster[t-1].member);try{for(x.s();!(f=x.n()).done;){var g=f.value;u.set(g[e],1)}}catch(P){x.e(P)}finally{x.f()}var v=d.u().range([0,550]);v.domain(d.i(n,(function(t){return G(t[i[0].field])})));var m,w=d.t().range([30,0]),k=Object(p.a)(r[0].variable[y].member);try{var b=function(){var t=m.value;if(!u.has(t)){w.domain(d.i([].concat(n.map((function(e){return e[t]})))));var e=d.l().curve(d.g).x((function(t){return v(G(t[i[0].field]))})).y((function(e){return w(e[t])}));o.append("path").attr("d",e(n)).attr("stroke","#AFAFAF").attr("stroke-width","1px").attr("opacity","20%").attr("fill","none")}};for(k.s();!(m=k.n()).done;)b()}catch(P){k.e(P)}finally{k.f()}var _,O=Object(p.a)(u.keys());try{var A=function(){var t=_.value;w.domain(d.i([].concat(n.map((function(e){return e[t]})))));var e=d.l().curve(d.g).x((function(t){return v(G(t[i[0].field]))})).y((function(e){return w(e[t])}));o.append("path").attr("d",e(n)).attr("stroke","#AFAFAF").attr("stroke-width","1px").attr("opacity","80%").attr("fill","none")};for(O.s();!(_=O.n()).done;)A()}catch(P){O.e(P)}finally{O.f()}w.domain(d.i([].concat(n.map((function(a){return a[r[0].cluster[t-1].representation[e]]})))));var F=d.l().curve(d.g).x((function(t){return v(G(t[i[0].field]))})).y((function(a){return w(a[r[0].cluster[t-1].representation[e]])}));o.append("path").attr("d",F(n)).attr("stroke",R[y]).attr("stroke-width","1px").attr("fill","none")},y=0;y<r[0].variable.length;y++)u()},G=function(t){return d.D("%Y-%m-%d")(t)?d.D("%Y-%m-%d")(t):d.D("%Y/%m/%d")(t)?d.D("%Y/%m/%d")(t):d.D("%Y-%m")(t)?d.D("%Y-%m")(t):d.D("%Y/%m")(t)?d.D("%Y/%m")(t):d.D("%Y")(t)?d.D("%Y")(t):d.D("%Y-%m-%dT%H:%M:%S.%fZ")(t)?d.D("%Y-%m-%dT%H:%M:%S.%fZ")(t):t},K=U,Z=function(t){Object(i.a)(a,t);var e=Object(l.a)(a);function a(){var t;return Object(r.a)(this,a),(t=e.call(this))._x="",t._y="",t}return Object(n.a)(a,[{key:"display",value:function(){var t=this.factdata(),e=this.measure(),a=this.breakdown(),r=this.focus();t=t.sort((function(t,e){return Q(t[a[0].field])-Q(e[a[0].field])}));for(var n="count"===e[0].aggregate?"COUNT":e[0].field,i=600,l=280,o=15,s=20,c=i-s-20,p=l-o-15,f=this.container(),h=d.w(f).append("svg").attr("width",i).attr("height",l).append("g").attr("transform","translate("+(s+10)+","+o+")").attr("font-family","OPPOSans"),u=d.u().range([0,c-20]),y=d.t().range([p-20,0]),x=[],g=Q(t[1][a[0].field])-Q(t[0][a[0].field]),v=1;v<=r[0].value.length;v++){var m={};m[a[0].field]=new Date(Q(t[t.length-1][a[0].field]).getTime()+g*v),m.value=r[0].value[v-1],m.up=r[0].up[v-1],m.low=r[0].low[v-1],x.push(m)}u.domain(d.i([Q(t[0][a[0].field]),x[x.length-1][a[0].field]])),y.domain(d.i([].concat(t.map((function(t){return.85*t[e[0].field]})),t.map((function(t){return 1.15*t[e[0].field]})))));var w=W(t[0][a[0].field]),k=J(t[0][a[0].field]),b=d.b(u).tickFormat(k);w===d.E&&b.ticks(w);var _=d.a().x((function(t){return u(t[a[0].field])})).y0((function(t){return y(t.low)})).y1((function(t){return y(t.up)}));h.append("g").selectAll("path.area").data(x).enter().append("path").attr("class","area").attr("d",_(x)).attr("fill","#E4E4E4").attr("opacity",.7);var O=h.append("g").attr("class","lineLayer");O.append("g").selectAll("line.line").data(y.ticks(5)).enter().append("line").attr("x1",0).attr("x2",c-20).attr("y1",(function(t){return y(t)})).attr("y2",(function(t){return y(t)})).attr("stroke","#E6E6E6").attr("stroke-width","2px");var A=d.l().curve(d.g).x((function(t){return u(Q(t[a[0].field]))})).y((function(t){return y(t[n])})),F=d.l().curve(d.g).x((function(t){return u(t[a[0].field])})).y((function(t){return y(t.value)}));O.append("path").attr("d",F(x)).attr("stroke","#6C8EF2").attr("stroke-width","3px").attr("fill","none").attr("stroke-dasharray","8px"),console.log(x);var P=O.append("path").attr("d",A(t)).attr("stroke","#6C8EF2").attr("stroke-width","3px").attr("fill","none");h.append("line").attr("x1",u(x[0][a[0].field])).attr("y1",p-20).attr("x2",u(x[0][a[0].field])).attr("y2",y(x[0].value)).attr("stroke","black").attr("stroke-width","1px").attr("stroke-dasharray","2px");var S=[];S.push(Q(t[0][a[0].field])),S.push(x[0][a[0].field]),S.push(x[x.length-1][a[0].field]),b.tickValues(S);var B=h.append("g").attr("class","tooltip");return q(f,P,u,y,p,t,a,n,k,B),h.append("g").attr("class","xAxis").attr("transform","translate(0,"+(p-20)+")").call(b).call((function(t){t.attr("font-size","10px"),t.attr("font-family","OPPOSans"),t.attr("font-weight","light");var e=t.selectAll(".domain").attr("d");e=(e=e.replace("6V",6*l/320+"V")).replace("V6","V"+6*l/320),t.selectAll(".domain").attr("d",e).attr("stroke-width",2),t.selectAll(".tick").selectAll("line").attr("stroke","#000000").attr("stroke-width",2).attr("y2",5),t.selectAll("text").attr("y",10)})),h.append("g").attr("class","yAxis").call(d.c(y).ticks(5).tickFormat((function(t){return t/1e6>=1?t=t/1e6+"M":t/1e3>=1&&(t=t/1e3+"K"),t}))).call((function(t){t.attr("font-size","10px"),t.attr("font-weight","light"),t.attr("font-family","OPPOSans");var e=t.selectAll(".domain").attr("d");e=(e=e.replace("M-6","M-"+6*i/640)).replace("H-6","H-"+6*i/640),t.selectAll(".domain").attr("d",e).attr("stroke-width",2),t.selectAll(".tick").select("line").attr("stroke","#000000").attr("stroke-width",2).attr("x2",-5),t.selectAll("text").attr("x",-10)})),h}}]),a}(y),q=function(t,e,a,r,n,i,l,o,s,c){var p=d.w(t).append("div").style("width","95px").style("height","40px").style("opacity",0).style("position","absolute").style("pointer-events","none").style("border-radius","4px").style("background","#FFFFFF").style("box-shadow","0 0 5px #888888").style("padding","5px"),f=p.append("span").style("font","9px ".concat("OPPOSans")).style("font-weight","bold").style("display","block").style("color","#000000"),h=p.append("svg").attr("width","95px").attr("height","30px"),u=h.append("circle").attr("r",4).attr("cx","5px").attr("cy","12px"),y=h.append("text").style("font","8px ".concat("OPPOSans")).style("color","#000000").attr("x","14px").attr("y","14px");e.on("mouseover",(function(t){p.transition().duration(200).style("opacity",.9),g.transition().duration(200).style("opacity",1)})).on("mouseout",(function(t){document.elementFromPoint(d.h.pageX,d.h.pageY)!==m.node()&&(p.transition().duration(500).style("opacity",0),g.transition().duration(500).style("opacity",0))})).on("mousemove",(function(t){var e=a.invert(d.o(this)[0]),n=x(i,e,1),c=Q(i[n-1][l[0].field]),h=Q(i[n][l[0].field]),g=e-c>h-e?h:c,w=g===c?i[n-1][o]:i[n][o],k=s(g);p.style("left",d.o(this)[0]+30+"px").style("top",d.o(this)[1]+20+"px"),f.html(k),u.style("fill","#6C8EF2"),y.html(o+": "+w),v.attr("x1",a(g)),v.attr("x2",a(g)),m.attr("cx",a(g)),m.attr("cy",r(w)),m.attr("stroke","#6C8EF2")}));var x=d.d((function(t){return Q(t[l[0].field])})).left,g=c.append("g").style("opacity",0),v=g.append("line").attr("y1",n-20).attr("y2",0).attr("stroke-width","2px").attr("stroke","#E6E6E6").attr("stroke-dasharray","6, 3"),m=g.append("circle").attr("r",3).attr("fill","#FFFFFF").attr("stroke-width","2").style("box-shadow","0 0 5px #888888").on("mouseover",(function(t){p.transition().duration(200).style("opacity",.9),g.transition().duration(200).style("opacity",1)})).on("mouseout",(function(t){p.transition().duration(500).style("opacity",0),g.transition().duration(500).style("opacity",0)}))},Q=function(t){return d.D("%Y-%m-%d")(t)?d.D("%Y-%m-%d")(t):d.D("%Y/%m/%d")(t)?d.D("%Y/%m/%d")(t):d.D("%Y-%m")(t)?d.D("%Y-%m")(t):d.D("%Y/%m")(t)?d.D("%Y/%m")(t):d.D("%Y")(t)?d.D("%Y")(t):d.D("%Y-%m-%dT%H:%M:%S.%fZ")(t)?d.D("%Y-%m-%dT%H:%M:%S.%fZ")(t):t},J=function(t){return d.D("%Y-%m-%d")(t)?d.B("%Y-%-m-%-d"):d.D("%Y/%m/%d")(t)?d.B("%Y/%-m/%-d"):d.D("%Y-%m")(t)?d.B("%Y-%m"):d.D("%Y/%m")(t)?d.B("%Y/%m"):d.D("%Y")(t)?d.B("%Y"):d.D("%Y-%m-%dT%H:%M:%S.%fZ")(t)?d.B("%m/%d %H"):""},W=function(t){return d.D("%Y-%m-%d")(t)||d.D("%Y/%m/%d")(t)?d.A:d.D("%Y-%m")(t)||d.D("%Y/%m")(t)?d.C:d.D("%Y")(t)?d.E:void 0},$=Z,tt=function(t){Object(i.a)(a,t);var e=Object(l.a)(a);function a(){var t;return Object(r.a)(this,a),(t=e.call(this))._x="",t._y="",t}return Object(n.a)(a,[{key:"display",value:function(){var t=this.factdata(),e=this.measure(),a=this.breakdown(),r=this.focus(),n=t=t.sort((function(t,e){return x(t[a[0].field])-x(e[a[0].field])})),i="count"===e[0].aggregate?"COUNT":e[0].field;if(0!==r.length){var l=600,o=280,s=15,c=20,f=l-c-20,h=o-s-15,u=d.w(this.container()).append("svg").attr("width",l).attr("height",o).append("g").attr("transform","translate("+(c+10)+","+s+")").attr("font-family","OPPOSans"),y=d.u().range([0,f-10]),m=d.t().range([h-20,0]);y.domain(d.i(n,(function(t){return x(t[a[0].field])}))),m.domain(d.i([].concat(n.map((function(t){return t[e[0].field]})),n.map((function(t){return.95*r[0].lower})),n.map((function(t){return 1.05*r[0].upper})))));var w=v(n[0][a[0].field]),k=g(n[0][a[0].field]),b=d.b(y).tickFormat(k);w===d.E&&b.ticks(w);var _=u.append("g").attr("class","lineLayer");_.append("g").selectAll("line.line").data(m.ticks(5)).enter().append("line").attr("x1",0).attr("x2",l).attr("y1",(function(t){return m(t)})).attr("y2",(function(t){return m(t)})).attr("stroke","#E6E6E6").attr("stroke-width","2px");for(var O=[],A=0;A<r[0].lower.length;A++)O.push({time:n[A][a[0].field],lower:r[0].lower[A],upper:r[0].upper[A]});var F=d.a().curve(d.g).x((function(t){return y(x(t.time))})).y0((function(t){return m(t.lower)})).y1((function(t){return m(t.upper)}));_.append("path").attr("stroke","#E4E4E4").attr("fill","#E4E4E4").attr("opacity",.7).attr("d",F(O));var P,S=d.l().curve(d.g).x((function(t){return y(x(t[a[0].field]))})).y((function(t){return m(t[i])})),B=d.l().curve(d.g).x((function(t){return y(x(t.x))})).y((function(t){return m(t.y)})),E=_.append("path").attr("d",S(n)).attr("stroke","#808080").attr("stroke-width","3px").attr("fill","none"),M=u.append("g").attr("class","tooltip"),Y=[],C=Object(p.a)(r);try{for(C.s();!(P=C.n()).done;){var T=P.value,z=void 0,j=void 0,D=void 0,N=void 0,I=void 0;if(T.scope[0]!==T.scope[1]){N=Math.max(0,T.scope[0]-1),I=Math.min(n.length-1,T.scope[1]+1);var V=y(x(n[N][a[0].field])),H=y(x(n[I][a[0].field]));z=(V+H)/2;var L=Math.floor((N+I)/2);n[L][i]<r[0].lower[L]?(j=d.m(n.slice(N,I+1),(function(t){return m(t[i])})),D=!1):(j=d.n(n.slice(N,I+1),(function(t){return m(t[i])})),D=!0),M.append("line").attr("x1",V).attr("y1",m(n[N][i])).attr("x2",V).attr("y2",h-20).attr("stroke","black").attr("stroke-dasharray","6, 3"),M.append("line").attr("x1",H).attr("y1",m(n[I][i])).attr("x2",H).attr("y2",h-20).attr("stroke","black").attr("stroke-dasharray","6, 3"),Y.push(x(n[N][a[0].field])),Y.push(x(n[I][a[0].field]))}else N=Math.max(0,T.start-1),I=Math.min(n.length,T.scope[1]+1),z=y(x(n[T.scope[0]][a[0].field])),j=m(n[T.scope[0]][i]),D=!(n[T.scope[0]][i]<r[0].lower[T.scope[0]]),M.append("line").attr("x1",z).attr("y1",j).attr("x2",z).attr("y2",h-20).attr("stroke","black").attr("stroke-dasharray","6, 3"),M.append("circle").attr("class","focusDot").attr("cx",z).attr("cy",j).attr("r","4px").attr("stroke","#F72D35").attr("fill","#F72D35"),Y.push(x(n[T.scope[0]][a[0].field]));var R=[],U=N;for(0!==T.scope[0]&&(R.push({x:n[U][a[0].field],y:n[U][i]}),U+=1);U<I;U++)R.push({x:n[U][a[0].field],y:r[0].forecast[U]});T.scope[1]!==n.length-1?R.push({x:n[U][a[0].field],y:n[U][i]}):R.push({x:n[U][a[0].field],y:r[0].forecast[U]}),M.append("path").attr("d",B(R)).attr("stroke","#B1B1B1").attr("stroke-width","3px").attr("stroke-dasharray","6, 3").attr("fill","none"),M.append("path").attr("d",S(n.slice(N,I+1))).attr("stroke","#F72D35").attr("stroke-width","5px").attr("fill","none");var X=M.append("g"),G=X.append("text").attr("font-size","10px").attr("font-family","OPPOSans").attr("stroke","#F72D35");G.append("tspan").text("Anomaly score: "+T.score.toFixed(2)).attr("dy",.9*G.selectAll("tspan").node().getBBox().height);var K=X.node().getBBox().width,Z=X.node().getBBox().height,q=j;D?q-=Z+8:q+=8,X.append("image").attr("xlink:href","./alert.svg").attr("width","15px").attr("height","13px").attr("x",z-(K+17)/2).attr("y",q+2),G.attr("width",K).attr("height",Z).attr("x",z-(K+17)/2+17).attr("y",q)}}catch(Q){C.e(Q)}finally{C.f()}return b.tickValues(Y),this._showTooltip&&et("#whole-container",E,y,m,h,n,a,i,k,M),u.append("g").attr("class","xAxis").attr("transform","translate(0,"+(h-20)+")").call(b).attr("font-family","OPPOSans").call((function(t){t.attr("font-size",10),t.attr("font-family","OPPOSans");var e=t.selectAll(".domain").attr("d");e=(e=e.replace("6V",6*o/320+"V")).replace("V6","V"+6*o/320),t.selectAll(".domain").attr("d",e).attr("stroke-width",2),t.selectAll(".tick").selectAll("line").attr("stroke","#000000").attr("stroke-width",2).attr("y2",6*o/320),t.selectAll("text").attr("y",9*o/320)})),u.append("g").attr("class","yAxis").call(d.c(m).ticks(5).tickFormat((function(t){return t/1e6>=1?t=t/1e6+"M":t/1e3>=1&&(t=t/1e3+"K"),t}))).call((function(t){t.attr("font-size","10px"),t.attr("font-weight","light"),t.attr("font-family","OPPOSans");var e=t.selectAll(".domain").attr("d");e=(e=e.replace("M-6","M-"+6*l/640)).replace("H-6","H-"+6*l/640),t.selectAll(".domain").attr("d",e).attr("stroke-width",2),t.selectAll(".tick").select("line").attr("stroke","#000000").attr("stroke-width",2).attr("x2",-6*l/640),t.selectAll("text").attr("x",-9*l/640)})),u}}}]),a}(y),et=function(t,e,a,r,n,i,l,o,s,c){var p=d.w(t).append("div").attr("id","value-tooltip").style("z-index",2e3).style("width","fit-content").style("height","40px").style("opacity",0).style("position","absolute").style("pointer-events","none").style("border-radius","4px").style("background","#FFFFFF").style("box-shadow","0 0 5px #888888").style("padding","5px"),f=p.append("span").style("font","9px ".concat("OPPOSans")).style("font-weight","bold").style("display","block").style("color","#000000"),h=p.append("svg").attr("width","95px").attr("height","30px").style("display","block").style("word-break","normal").style("word-warp","break-word").style("overflow","hidden"),u=h.append("circle").attr("r",4).attr("cx","5px").attr("cy","12px"),y=h.append("text").style("font","8px ".concat("OPPOSans")).style("color","#000000").attr("x","14px").attr("y","14px");e.on("mouseover",(function(t){p.transition().duration(200).style("opacity",.9),v.transition().duration(200).style("opacity",1)})).on("mouseout",(function(t){document.elementFromPoint(d.h.pageX,d.h.pageY)!==w.node()&&(p.transition().duration(500).style("opacity",0),v.transition().duration(500).style("opacity",0))})).on("mousemove",(function(t){var e=b(),n=a.invert(d.o(this)[0]),c=g(i,n,1),h=x(i[c-1][l[0].field]),v=x(i[c][l[0].field]),k=n-h>v-n?v:h,_=k===h?i[c-1][o]:i[c][o],O=s(k);p.style("left",e.posX+30+"px").style("top",e.posY+20+"px"),f.html(O),u.style("fill","#808080"),y.html(o+": "+_.toFixed(2)),m.attr("x1",a(k)),m.attr("x2",a(k)),w.attr("cx",a(k)),w.attr("cy",r(_)),w.attr("stroke","#808080")}));var g=d.d((function(t){return x(t[l[0].field])})).left,v=c.append("g").style("opacity",0),m=v.append("line").attr("y1",n-20).attr("y2",0).attr("stroke-width","2px").attr("stroke","#E6E6E6").attr("stroke-dasharray","6, 3"),w=v.append("circle").attr("r",3).attr("fill","#FFFFFF").attr("stroke-width","2").style("box-shadow","0 0 5px #888888").on("mouseover",(function(t){p.transition().duration(200).style("opacity",.9),v.transition().duration(200).style("opacity",1)})).on("mouseout",(function(t){p.transition().duration(500).style("opacity",0),v.transition().duration(500).style("opacity",0)}))},at=tt,rt=["#6C8EF2","#92551D","#8B65BA","#4B8384","#5EA211"],nt={baseline:"#d2cffd",Compare:"#f5bf27"},it="#ffc136",lt="#ffffff",ot=10,st=2,dt=function(t){Object(i.a)(a,t);var e=Object(l.a)(a);function a(t){var n;return Object(r.a)(this,a),(n=e.call(this,t))._x="",n._y="",n.props=t,n}return Object(n.a)(a,[{key:"display",value:function(){var t=this.parsrFact(),e=t.data,a=t.measure,r=t.breakdown,n=t.focus,i=t.subspace;if(0!==n.length){var l=this.setChartStandard(a,n),o=l._chartSize,s=l._width,c=l._height,p=l._margin,f=this.initSvg(o,p);this.drawLegend(f,s);var h,u,y,x,g=this.drawXAxis(f,e,r,s,c,o),v=g._x,m=g._tick_format,w=f.append("g").attr("class","lineLayer"),k=f.append("g").attr("class","yAxis"),b=f.append("g").attr("class","simiblock"),_=(c-20+15)/a.length,O=this.setSeriesColor(a),A=[],F=[];n.forEach((function(t,a){"Base Line"===t.value[0].text&&(u=t.value[0].start,y=t.value[0].end,x=t.field,h=d.i(e.slice(u,y+1),(function(t){return t[x]})))}));for(var P=0;P<a.length;P++){var S=a[P].field,B=this.drawYAxis(e,k,o,_,S,O,P),E=this.drawBackLine(w,e,v,B,o,r,S,O),M=d.t().domain([0,1]).range([.001,.5]);this.drawSimiPart(i,e,v,_,n,r,a,b,A,F,h,E,O,M,S,P)}return this._showTooltip&&ct(this.tooltipId,"#whole-container",A,F,e,r,m,{field:x,start:u,end:y},O),f}}},{key:"parsrFact",value:function(){var t=this.factdata(),e=this.measure(),a=this.breakdown(),r=this.focus(),n=this.subspace();return{data:t=t.sort((function(t,e){return x(t[a[0].field])-x(e[a[0].field])})),measure:e,breakdown:a,focus:r,subspace:n}}},{key:"setChartStandard",value:function(t,e){var a={width:600,height:360},r={top:15,right:20,bottom:15,left:20};return{_width:a.width-r.left-r.right,_height:a.height-r.top-r.bottom,_chartSize:a,_margin:r}}},{key:"initSvg",value:function(t,e){return d.w(this.container()).append("svg").attr("width",t.width).attr("height",t.height).append("g").attr("transform","translate("+(e.left+10)+","+e.top+")").attr("font-family","OPPOSans")}},{key:"drawLegend",value:function(t,e){var a=d.t().domain([400,e-70]).range([0,1]),r=d.k(it,lt);t.selectAll("rect").data(d.s(400,e-70,1)).enter().append("rect").attr("x",(function(t,e){return e+400})).attr("y",(function(t,e){return-10})).attr("width",1.1).attr("height",8).style("stroke",(function(t){return r(a(t))})).style("fill",(function(t){return r(a(t))})),t.append("text").attr("y",-2).attr("x",400).style("text-anchor","start").style("font-size","8px").text("100"),t.append("text").attr("y",-2).attr("x",e-70).style("text-anchor","start").style("font-size","8px").text("0"),t.append("text").attr("y",-2).attr("x",e-60+7).style("text-anchor","start").style("font-size","8px").text("Similarity Score")}},{key:"drawXAxis",value:function(t,e,a,r,n,i){var l=g(e[0][a[0].field]),o=d.u().domain(d.i(e,(function(t){return x(t[a[0].field])}))).range([30,r-10]),s=d.b(o).ticks(5).tickFormat(d.B("%Y/%m/%d/%H"));return t.append("g").attr("class","xAxis").attr("transform","translate(0,"+(n-20)+")").call(s).attr("font-family","OPPOSans").call((function(t){t.attr("font-size",ot),t.attr("font-family","OPPOSans");var e=t.selectAll(".domain").attr("d");e=(e=e.replace("6V",6*i.height/320+"V")).replace("V6","V"+6*i.height/320),t.selectAll(".domain").attr("d",e).attr("stroke-width",st),t.selectAll(".tick").selectAll("line").attr("stroke","#000000").attr("stroke-width",st).attr("y2",6*i.height/320),t.selectAll("text").attr("y",9*i.height/320)})).call(s),{_x:o,_tick_format:l}}},{key:"drawYAxis",value:function(t,e,a,r,n,i,l){var o=d.t().range([r*(l+1)-15,r*l]);o.domain(d.i([].concat(t.map((function(t){return.95*t[n]})),t.map((function(t){return 1.05*t[n]}))))),e.append("g").attr("transform","translate(30, 0)").call(d.c(o).ticks(5).tickFormat((function(t){return t/1e6>=1?t=t/1e6+"M":t/1e3>=1&&(t=t/1e3+"K"),t}))).call((function(t){t.attr("font-size","10px"),t.attr("font-weight","light"),t.attr("font-family","OPPOSans");var e=t.selectAll(".domain").attr("d");e=(e=e.replace("M-6","M-"+6*a.width/640)).replace("H-6","H-"+6*a.width/640),t.selectAll(".domain").attr("d",e).attr("stroke-width",st),t.selectAll(".tick").select("line").attr("stroke","#000000").attr("stroke-width",st).attr("x2",-6*a.width/640),t.selectAll("text").attr("x",-9*a.width/640)}));var s=e.append("text").attr("transform","rotate(-90)").attr("y",-5).attr("x",0-(r*(2*l+1)-15)/2).style("text-anchor","middle").style("font-size","10px").text(n);return e.append("rect").attr("transform","rotate(-90)").style("text-anchor","middle").attr("x",s.node().getBBox().x).attr("y",s.node().getBBox().y).attr("width",s.node().getBBox().width+2).attr("height",s.node().getBBox().height).attr("fill",i[n]),s.node().remove(),e.append("text").attr("transform","rotate(-90)").attr("y",-5).attr("x",0-(r*(2*l+1)-15)/2).style("text-anchor","middle").style("font-size","10px").text(n),o}},{key:"setSeriesColor",value:function(t){for(var e={},a=0;a<t.length;a++)e[t[a].field]=rt[a%rt.length];return e}},{key:"drawBackLine",value:function(t,e,a,r,n,i,l,o){t.append("g").selectAll("line.line").data(r.ticks(5)).enter().append("line").attr("x1",30).attr("x2",n.width).attr("y1",(function(t){return r(t)})).attr("y2",(function(t){return r(t)})).attr("stroke","#E6E6E6").attr("stroke-width","2px");var s=d.l().curve(d.g).x((function(t){return a(x(t[i[0].field]))})).y((function(t){return r(t[l])}));return t.append("path").attr("d",s(e)).attr("stroke",o[l]).attr("stroke-width","2px").attr("fill","none"),s}},{key:"drawSimiPart",value:function(t,e,a,r,n,i,l,o,s,c,f,h,u,y,g,v){var m,w=Object(p.a)(n);try{var k=function(){var t=m.value;if(t.field===g){var n,w=t.value,k=Object(p.a)(w);try{var b=function(){var p=n.value,m=Math.max(0,p.start),w=Math.min(e.length-1,p.end+1),k=o.append("rect").attr("x",a(x(e[m][i[0].field]))).attr("y",r*v).attr("width",a(x(e[w][i[0].field]))-a(x(e[m][i[0].field]))).attr("height",r-15).attr("fill",nt[t.tag]).attr("fill-opacity",(function(){return"baseline"===t.tag?.4:y(p.similarity_value)}));if("baseline"!==t.tag){var b=d.i(e.slice(m,w+1),(function(t){return t[g]}));s.push(k),c.push({field:t.field,start:m,end:w,ymax:b[1]>f[1]?b[1]:f[1],ymin:b[0]<f[0]?b[0]:f[0],similarity_value:p.similarity_value})}o.append("path").attr("d",h(e.slice(m,w+1))).attr("stroke",u[l[v].field]).attr("stroke-width","2px").attr("fill","none"),o.append("rect").attr("x",a(x(e[m][i[0].field]))).attr("y",r*v).attr("width",1).attr("height",r-15).attr("fill",nt[t.tag]),o.append("rect").attr("x",a(x(e[w][i[0].field]))-1).attr("y",r*v).attr("width",1).attr("height",r-15).attr("fill",nt[t.tag]),o.append("text").attr("x",a(x(e[m][i[0].field]))+5).attr("y",r*v+7+5).attr("fill","#000000").style("font-size","7px").style("font-family","OPPOSans").style("font-weight","bold").text(p.text)};for(k.s();!(n=k.n()).done;)b()}catch(_){k.e(_)}finally{k.f()}}};for(w.s();!(m=w.n()).done;)k()}catch(b){w.e(b)}finally{w.f()}}}]),a}(y),ct=function(t,e,a,r,n,i,l,o,s){var c=d.w(e).append("div").attr("id","hover-tooltip").style("z-index",2e3).style("width","200px").style("height","115px").style("opacity",0).style("position","absolute").style("pointer-events","none").style("padding-left","10px"),p=c.append("div").style("display","flex").style("align-items","center").style("height","15px").style("border","2px solid ".concat("#3E3A39")).style("border-radius","4px 4px 0px 0px").style("padding-left","5px").style("padding-right","5px").style("background","#3E3A39").style("font","7px ".concat("OPPOSans")).style("font-weight","bold").style("color","#FCFBE7").style("text-overflow","ellipsis").style("overflow","hidden").style("white-space","nowrap"),f=c.append("div").style("width","200px").style("height","100px").style("border","2px solid ".concat("#3E3A39")).style("border-radius","0px 4px 4px 4px").style("background","#FCFBE7");f.append("span").style("position","absolute").style("left","-10px").style("top","60px").style("border-width","10px").style("border-style","dashed solid dashed dashed").style("border-color","transparent ".concat("#3E3A39"," transparent transparent")).style("font-size",0).style("line-height",0),f.append("em").style("position","absolute").style("left","-4px").style("top","62px").style("border-width","8.2px").style("border-style","dashed solid dashed dashed").style("border-color","transparent ".concat("#FCFBE7"," transparent transparent")).style("font-size",0).style("line-height",0),f.append("div").attr("id","tooltip-chart"+t);for(var h=function(e){a[e].on("mouseover",(function(t){c.transition().duration(200).style("opacity",.9)})).on("mouseout",(function(t){c.transition().duration(500).style("opacity",0)})).on("mousemove",(function(a){var f=b();c.style("left",f.posX+30+"px").style("top",f.posY-50+"px");var h=l(x(n[r[e].start][i[0].field]))+"-"+l(x(n[r[e].end][i[0].field]));p.html(h);var u=d.t().domain([0,r[e].end-r[e].start]).range([0,195]),y=d.t().domain([.9*r[e].ymin,1.1*r[e].ymax]).range([100,0]),g=d.l().curve(d.g).x((function(t,e){return u(e)})).y((function(t,e){return y(t[o.field])})),v=d.l().curve(d.g).x((function(t,e){return u(e)})).y((function(t){return y(t[r[e].field])}));d.w("#tooltip-chart"+t).selectAll("*").remove();var m=d.w("#tooltip-chart"+t).append("svg").attr("class",r[e].field).attr("width","200").attr("height","100"),w=m.append("g").attr("font-family","OPPOSans");w.append("path").attr("d",g(n.slice(o.start,o.end+1))).attr("stroke","#5B8EF9").attr("stroke-width","2px").attr("fill","none"),w.append("path").attr("d",v(n.slice(r[e].start,r[e].end+1))).attr("stroke",s[r[e].field]).attr("stroke-width","2px").attr("fill","none"),w.append("rect").attr("x",6).attr("y",89).attr("width",15).attr("height",5).attr("fill","#5B8EF9"),w.append("text").attr("x",27).attr("y",93).attr("fill","#3e3a39").style("font-size","6px").style("font-family","OPPOSans").style("font-weight","bolder").text("Base Line"),w.append("text").attr("x",6).attr("y",8).attr("fill","#ffc111").style("font-size","7px").style("font-family","OPPOSans").style("font-weight","bolder").text((100*r[e].similarity_value).toFixed(2)),w.append("text").attr("x",30).attr("y",8).attr("fill","#3e3a39").style("font-size","7px").style("font-family","OPPOSans").style("font-weight","bolder").text("Similarity"),m.append("g").attr("transform","translate(200, 0)").call(d.c(y).ticks(3).tickFormat((function(t){return t/1e6>=1?t=t/1e6+"M":t/1e3>=1&&(t=t/1e3+"K"),t}))).call((function(t){t.attr("font-size","6px"),t.attr("font-weight","light"),t.attr("font-family","OPPOSans");var e=t.selectAll(".domain").attr("d");e=(e=e.replace("M-6","M-1.875")).replace("H-6","H-1.875"),t.selectAll(".domain").attr("d",e).attr("stroke-width","1px"),t.selectAll(".tick").select("line").attr("stroke","#000000").attr("stroke-width","1px").attr("x2",-1.875),t.selectAll("text").attr("x",-2.8125)}))}))},u=0;u<a.length;u++)h(u)},pt=dt,ft=["#6C8EF2","#92551D","#8B65BA","#4B8384","#5EA211"],ht=10,ut=2,yt=!1,xt=function(t){Object(i.a)(a,t);var e=Object(l.a)(a);function a(t){var n;return Object(r.a)(this,a),(n=e.call(this,t))._x="",n._y="",n.props=t,n}return Object(n.a)(a,[{key:"display",value:function(){for(var t=this.parsrFact(),e=t.data,a=t.measure,r=t.breakdown,n=(t.focus,this.setChartStandard(e,a)),i=n._chartSize,l=n._width,o=n._height,s=n._margin,d=this.initSvg(i,s),c=this.drawXAxis(d,e,r,l,o,i)._x,p=d.append("g").attr("class","lineLayer"),f=d.append("g").attr("class","yAxis"),h=d.append("div").attr("id","text-tooltip").style("z-index",2e3).style("width","200px").style("height","115px").style("opacity",.9).style("position","absolute").style("pointer-events","none").style("padding-left","10px"),u=(o-20+30)/a.length,y=(d.append("g").attr("class","simiblock"),this.setSeriesColor(a)),x=0;x<a.length;x++){var g=a[x].field,v=this.drawYAxis(e,f,h,i,u,g,y,x);this.drawBackLine(p,e,c,v,l,r,g,y)}return yt&&(yt=!1),d}},{key:"parsrFact",value:function(){var t=this.factdata(),e=this.measure(),a=this.breakdown(),r=this.focus();return{data:t=t.sort((function(t,e){return x(t[a[0].field])-x(e[a[0].field])})),measure:e,breakdown:a,focus:r}}},{key:"setChartStandard",value:function(t,e){var a={width:Math.max(2*t.length,1e3),height:120*e.length},r={top:15,right:50,bottom:15,left:20};return{_width:a.width-r.left-r.right,_height:a.height-r.top-r.bottom,_chartSize:a,_margin:r}}},{key:"initSvg",value:function(t,e){return d.w(this.container()).append("svg").attr("width",t.width).attr("height",t.height).append("g").attr("transform","translate("+(e.left+10)+","+e.top+")").attr("font-family","OPPOSans")}},{key:"drawXAxis",value:function(t,e,a,r,n,i){var l=d.u().domain(d.i(e,(function(t){return x(t[a[0].field])}))).range([60,r-10]),o=g(e[0][a[0].field]),s=d.b(l).ticks(5).tickFormat(o);return t.append("g").attr("class","xAxis").attr("transform","translate(0,"+(n-20)+")").call(s).attr("font-family","OPPOSans").call((function(t){t.attr("font-size",ht),t.attr("font-family","OPPOSans");var e=t.selectAll(".domain").attr("d");e=(e=e.replace("6V",6*i.height/320+"V")).replace("V6","V"+6*i.height/320),t.selectAll(".domain").attr("d",e).attr("stroke-width",ut),t.selectAll(".tick").selectAll("line").attr("stroke","#000000").attr("stroke-width",ut).attr("y2",6*i.height/320),t.selectAll("text").attr("y",9*i.height/320)})).call(s),{_x:l,_tick_format:o}}},{key:"drawYAxis",value:function(t,e,a,r,n,i,l,o){var s=d.t().range([n*(o+1)-30,n*o]);s.domain(d.i([].concat(t.map((function(t){return.95*t[i]})),t.map((function(t){return 1.05*t[i]}))))),e.append("g").attr("transform","translate(60, 0)").call(d.c(s).ticks(5).tickFormat((function(t){return t/1e6>=1?t=t/1e6+"M":t/1e3>=1&&(t=t/1e3+"K"),t}))).call((function(t){t.attr("font-size","10px"),t.attr("font-weight","light"),t.attr("font-family","OPPOSans");var e=t.selectAll(".domain").attr("d");e=(e=e.replace("M-6","M-6")).replace("M-6","M-6"),t.selectAll(".domain").attr("d",e).attr("stroke-width",ut),t.selectAll(".tick").select("line").attr("stroke","#000000").attr("stroke-width",ut).attr("x2",-6),t.selectAll("text").attr("x",-9)}));var c=i;return i.length>15&&(c=c.substr(0,15)+"..."),e.append("text").attr("transform","rotate(-90)").attr("y",20).attr("x",0-(n*(2*o+1)-30)/2).style("text-anchor","middle").style("font-size","12px").style("font-weight","bold").style("fill",l[i]).style("text-decoration","underline").style("cursor","pointer").text(c).on("mouseover",(function(t,e){a.html(i),a.transition().duration(200).style("opacity",.9)})).on("mouseout",(function(t){a.transition().duration(500).style("opacity",0)})).on("mousemove",(function(t){var e=b();a.style("left",e.posX+30+"px").style("top",e.posY-50+"px")})),s}},{key:"drawUniFocusPart",value:function(t,e,a,r,n,i,l,o,s,c,f){var h,u=this.props,y=Object(p.a)(r);try{for(y.s();!(h=y.n()).done;){var g=h.value;if(g.field===c){var v,m=g.value,w=Object(p.a)(m);try{for(w.s();!(v=w.n()).done;){var k=v.value,b=Math.max(0,k.start-1),_=Math.min(t.length-1,k.end+1);l.append("rect").attr("x",e(x(t[b][n[0].field]))).attr("y",a*f).attr("width",e(x(t[_][n[0].field]))-e(x(t[b][n[0].field]))).attr("height",a-30).attr("fill",(function(){return u.spec.chart.id,"#f5bf27"})).attr("fill-opacity",.2).attr("cursor","pointer").attr("id",c+"-"+k.start+"-"+k.end).attr("class","insight-block false").on("mouseover",(function(){d.w(this).transition().duration(500).attr("fill-opacity",.5)})).on("mouseout",(function(){d.w(this).transition().duration(500).attr("fill-opacity",.2)})).on("click",(function(){u.isPopInsightCard||u.setPopInsightCardState(!0)})),l.append("path").attr("d",o(t.slice(b,_+1))).attr("stroke",s[i[f].field]).attr("stroke-width","2px").attr("fill","none"),l.append("rect").attr("x",e(x(t[b][n[0].field]))).attr("y",a*f).attr("width",1).attr("height",a-30).attr("fill","#f5bf27"),l.append("rect").attr("x",e(x(t[_][n[0].field]))-1).attr("y",a*f).attr("width",1).attr("height",a-30).attr("fill","#f5bf27")}}catch(O){w.e(O)}finally{w.f()}}}}catch(O){y.e(O)}finally{y.f()}}},{key:"drawMultiFocusPart",value:function(t,e,a,r,n,i,l,o,s,c,f){var h,u=this.props,y=Object(p.a)(r);try{for(y.s();!(h=y.n()).done;){var g=h.value;if(g.field===c){var v=g.value[0],m=Math.max(0,v.start-1),w=Math.min(t.length-1,v.end+1);yt||l.append("rect").attr("x",e(x(t[m][n[0].field]))).attr("y",0).attr("width",e(x(t[w][n[0].field]))-e(x(t[m][n[0].field]))).attr("height",a-30).attr("fill",(function(){return u.spec.chart.id,"#f5bf27"})).attr("fill-opacity",.2).attr("cursor","pointer").attr("id",c+"-"+v.start+"-"+v.end).attr("class","insight-block false").on("mouseover",(function(){d.w(this).transition().duration(500).attr("fill-opacity",.5)})).on("mouseout",(function(){d.w(this).transition().duration(500).attr("fill-opacity",.2)})).on("click",(function(){u.isPopInsightCard||u.setPopInsightCardState(!0)})),l.append("path").attr("d",o(t.slice(m,w+1))).attr("stroke",s[i[f].field]).attr("stroke-width","2px").attr("fill","none"),yt||(l.append("rect").attr("x",e(x(t[m][n[0].field]))).attr("y",0).attr("width",1).attr("height",a-30).attr("fill","#f5bf27").attr("fill-opacity",.4),l.append("rect").attr("x",e(x(t[w][n[0].field]))-1).attr("y",0).attr("width",1).attr("height",a-30).attr("fill","#f5bf27").attr("fill-opacity",.4))}}}catch(k){y.e(k)}finally{y.f()}yt||(yt=!0)}},{key:"setSeriesColor",value:function(t){for(var e={},a=0;a<t.length;a++)e[t[a].field]=ft[a%ft.length];return e}},{key:"drawBackLine",value:function(t,e,a,r,n,i,l,o){t.append("g").selectAll("line.line").data(r.ticks(5)).enter().append("line").attr("x1",60).attr("x2",n-10).attr("y1",(function(t){return r(t)})).attr("y2",(function(t){return r(t)})).attr("stroke","#E6E6E6").attr("stroke-width","2px");var s=d.l().curve(d.g).x((function(t){return a(x(t[i[0].field]))})).y((function(t){return r(t[l])}));return t.append("path").attr("d",s(e)).attr("stroke",o[l]).attr("stroke-width","2px").attr("fill","none"),s}}]),a}(y),gt=function(t){Object(i.a)(a,t);var e=Object(l.a)(a);function a(){var t;return Object(r.a)(this,a),(t=e.call(this))._x="",t._y="",t}return Object(n.a)(a,[{key:"display",value:function(){for(var t=this.factdata(),e=this.measure(),a=this.breakdown(),r=this.focus(),n=[],i=function(a){for(var i=t.filter((function(n){return n[e[0].field]===t[r[a].index][e[0].field]})),l=0;l<i.length;l++)n.push(i[l])},l=0;l<r.length;l++)i(l);var o=[];(o=n.length<=3?n:[n[0],n[1],n[2]]).sort((function(t,e){return x(t[a[0].field])-x(e[a[0].field])}));var s=t.sort((function(t,e){return x(t[a[0].field])-x(e[a[0].field])})),c="count"===e[0].aggregate?"COUNT":e[0].field,f=600,h=280,u=15,y=20,m=f-y-20,w=h-u-15,k=d.w(this.container()).append("svg").attr("width",f).attr("height",h).append("g").attr("transform","translate("+(y+10)+","+u+")").attr("font-family","OPPOSans"),b=d.u().range([0,m-20]),_=d.t().range([w-20,0]);b.domain(d.i(s,(function(t){return x(t[a[0].field])}))),_.domain(d.i([].concat(s.map((function(t){return.95*t[e[0].field]})),s.map((function(t){return 1.05*t[e[0].field]})))));var O=v(s[0][a[0].field]),A=g(s[0][a[0].field]),F=d.b(b).tickFormat(A);O===d.E&&F.ticks(O);var P=k.append("g").attr("class","lineLayer");P.append("g").selectAll("line.line").data(_.ticks(5)).enter().append("line").attr("x1",0).attr("x2",m-20).attr("y1",(function(t){return _(t)})).attr("y2",(function(t){return _(t)})).attr("stroke","#E6E6E6").attr("stroke-width","2px");var S,B=d.l().curve(d.g).x((function(t){return b(x(t[a[0].field]))})).y((function(t){return _(t[c])})),E=P.append("path").attr("d",B(s)).attr("stroke","#6C8EF2").attr("stroke-width","3px").attr("fill","none"),M=d.x().type(d.y).size(16),Y=k.append("g").attr("class","tooltip"),C=Object(p.a)(o);try{for(C.s();!(S=C.n()).done;){var T=S.value;k.append("g").attr("transform","translate("+b(x(T[a[0].field]))+","+_(T[c])+")").append("path").attr("d",M()).attr("fill","#F5BF27"),k.append("line").attr("x1",b(x(T[a[0].field]))).attr("y1",w-20).attr("x2",b(x(T[a[0].field]))).attr("y2",_(T[c])).attr("stroke","black").attr("stroke-width","1px").attr("stroke-dasharray","2px")}}catch(V){C.e(V)}finally{C.f()}var z=Y.append("text").attr("font-size","10px").attr("font-family","OPPOSans").attr("fill","#000000");z.append("tspan").text(Math.round(100*o[0][c])/100);var j=z.node().getBBox().width,D=z.node().getBBox().height;z.attr("width",j).attr("height",D).attr("x",b(x(o[0][a[0].field]))-1.05*j).attr("y",_(o[0][c])-D/2),o.length>1&&((z=Y.append("text").attr("font-size","10px").attr("font-family","OPPOSans").attr("fill","#000000")).append("tspan").text(Math.round(100*o[1][c])/100),j=z.node().getBBox().width,D=z.node().getBBox().height,z.attr("width",j).attr("height",D).attr("x",b(x(o[1][a[0].field]))-j/2).attr("y",_(o[1][c])-D/2)),o.length>2&&((z=Y.append("text").attr("font-size","10px").attr("font-family","OPPOSans").attr("fill","#000000")).append("tspan").text(Math.round(100*o[2][c])/100),j=z.node().getBBox().width,D=z.node().getBBox().height,z.attr("width",j).attr("height",D).attr("x",b(x(o[2][a[0].field]))+.05*j).attr("y",_(o[2][c])-D/2));for(var N=[],I=0;I<o.length;I++)N.push(x(o[I][a[0].field]));return F.tickValues(N),this._showTooltip&&vt("#whole-container",E,b,_,w,s,a,c,A,Y),k.append("g").attr("class","xAxis").attr("transform","translate(0,"+(w-20)+")").call(F).call((function(t){t.attr("font-size","10px"),t.attr("font-family","OPPOSans"),t.attr("font-weight","light");var e=t.selectAll(".domain").attr("d");e=(e=e.replace("6V",6*h/320+"V")).replace("V6","V"+6*h/320),t.selectAll(".domain").attr("d",e).attr("stroke-width",2),t.selectAll(".tick").selectAll("line").attr("stroke","#000000").attr("stroke-width",2).attr("y2",5),t.selectAll("text").attr("y",10).attr("style","text-anchor: end")})),k.append("g").attr("class","yAxis").call(d.c(_).ticks(5).tickFormat((function(t){return t/1e6>=1?t=t/1e6+"M":t/1e3>=1&&(t=t/1e3+"K"),t}))).call((function(t){t.attr("font-size","10px"),t.attr("font-weight","light"),t.attr("font-family","OPPOSans");var e=t.selectAll(".domain").attr("d");e=(e=e.replace("M-6","M-"+6*f/640)).replace("H-6","H-"+6*f/640),t.selectAll(".domain").attr("d",e).attr("stroke-width",2),t.selectAll(".tick").select("line").attr("stroke","#000000").attr("stroke-width",2).attr("x2",-5),t.selectAll("text").attr("x",-10)})),k}}]),a}(y),vt=function(t,e,a,r,n,i,l,o,s,c){var p=d.w(t).append("div").attr("id","value-tooltip").style("z-index",2e3).style("width","fit-content").style("height","40px").style("opacity",0).style("position","absolute").style("pointer-events","none").style("border-radius","4px").style("background","#FFFFFF").style("box-shadow","0 0 5px #888888").style("padding","5px"),f=p.append("span").style("font","9px ".concat("OPPOSans")).style("font-weight","bold").style("display","block").style("color","#000000"),h=p.append("svg").attr("width","95px").attr("height","30px"),u=h.append("circle").attr("r",4).attr("cx","5px").attr("cy","12px"),y=h.append("text").style("font","8px ".concat("OPPOSans")).style("color","#000000").attr("x","14px").attr("y","14px");e.on("mouseover",(function(t){p.transition().duration(200).style("opacity",.9),v.transition().duration(200).style("opacity",1)})).on("mouseout",(function(t){document.elementFromPoint(d.h.pageX,d.h.pageY)!==w.node()&&(p.transition().duration(500).style("opacity",0),v.transition().duration(500).style("opacity",0))})).on("mousemove",(function(t){var e=b(),n=a.invert(d.o(this)[0]),c=g(i,n,1),h=x(i[c-1][l[0].field]),v=x(i[c][l[0].field]),k=n-h>v-n?v:h,_=k===h?i[c-1][o]:i[c][o],O=s(k);p.style("left",e.posX+30+"px").style("top",e.posY+20+"px"),f.html(O),u.style("fill","#6C8EF2"),y.html(o+": "+_.toFixed(2)),m.attr("x1",a(k)),m.attr("x2",a(k)),w.attr("cx",a(k)),w.attr("cy",r(_)),w.attr("stroke","#6C8EF2")}));var g=d.d((function(t){return x(t[l[0].field])})).left,v=c.append("g").style("opacity",0),m=v.append("line").attr("y1",n-20).attr("y2",0).attr("stroke-width","2px").attr("stroke","#E6E6E6").attr("stroke-dasharray","6, 3"),w=v.append("circle").attr("r",3).attr("fill","#FFFFFF").attr("stroke-width","2").style("box-shadow","0 0 5px #888888").on("mouseover",(function(t){p.transition().duration(200).style("opacity",.9),v.transition().duration(200).style("opacity",1)})).on("mouseout",(function(t){p.transition().duration(500).style("opacity",0),v.transition().duration(500).style("opacity",0)}))},mt=gt,wt=function(t){Object(i.a)(a,t);var e=Object(l.a)(a);function a(){var t;return Object(r.a)(this,a),(t=e.call(this))._x="",t._y="",t}return Object(n.a)(a,[{key:"display",value:function(){var t=this.parseFact(),e=t._data,a=t._measure,r=t._breakdown,n=t._focus,i=t._measureName;if(0!==n.length&&(!r[1]||!r[1].field)){var l=this.setChartStandard(),o=l._chartSize,s=l._width,d=l._height,c=l._margin,p=this.initSvg(o,c),f=p.append("g").attr("class","lineLayer"),h=this.drawXAxis(p,e,r,n,s,d,o)._x,u=this.drawYAxis(p,e,a,n,o,d);return this.drawBackLine(h,u,e,f,r,i,n,o,d),p}}},{key:"parseFact",value:function(){var t=this.factdata(),e=this.measure(),a=this.breakdown(),r=this.focus(),n=t=t.sort((function(t,e){return x(t[a[0].field])-x(e[a[0].field])})),i="count"===e[0].aggregate?"COUNT":e[0].field;return{_data:n,_measure:e,_breakdown:a,_focus:r,_measureName:i}}},{key:"setChartStandard",value:function(){var t={width:600,height:280},e={top:15,right:20,bottom:15,left:20};return{_width:t.width-e.left-e.right,_height:t.height-e.top-e.bottom,_chartSize:t,_margin:e}}},{key:"initSvg",value:function(t,e){return d.w(this.container()).append("svg").attr("width",t.width).attr("height",t.height).append("g").attr("transform","translate("+(e.left+10)+","+e.top+")").attr("font-family","OPPOSans")}},{key:"drawXAxis",value:function(t,e,a,r,n,i,l){var o=d.t().range([0,n]);o.domain([-1,r[0].correlation.length]);for(var s=[],c=0;c<r[0].correlation.length;c++)s.push(c);var p=d.b(o).tickValues(s).ticks(s.length).tickFormat(d.j("d"));return t.append("g").attr("class","xAxis").attr("transform","translate(0,"+(i-20)+")").call(p).call((function(t){t.attr("font-size","10px"),t.attr("font-family","OPPOSans"),t.attr("font-weight","lighter"),t.selectAll(".tick").selectAll("line").attr("stroke","#000000").attr("stroke-width",2).attr("y2",5),t.selectAll("text").attr("y",10)})),{_x:o,_axisX:p}}},{key:"drawYAxis",value:function(t,e,a,r,n,i){var l=d.t().range([i-20,0]);return l.domain(d.i([].concat(r[0].correlation.map((function(t){return t>=0?.9*t:2*t})),r[0].correlation.map((function(t){return 1.1*t}))))),t.append("g").attr("class","yAxis").call(d.c(l).ticks(5).tickFormat(d.j(".1f"))).call((function(t){t.attr("font-size","10px"),t.attr("font-weight","lighter"),t.attr("font-family","OPPOSans"),t.selectAll(".tick").select("line").attr("stroke","#000000").attr("stroke-width",2).attr("x2",-5),t.selectAll("text").attr("x",-10)})),l}},{key:"drawBackLine",value:function(t,e,a,r,n,i,l,o,s){r.append("g").selectAll("line.line").data(e.ticks(5)).enter().append("line").attr("x1",0).attr("x2",o.width).attr("y1",(function(t){return e(t)})).attr("y2",(function(t){return e(t)})).attr("stroke","#E6E6E6").attr("stroke-width","2px");for(var c=0;c<l[0].correlation.length;c++)r.append("circle").attr("cx",t(c)).attr("cy",e(l[0].correlation[c])).attr("r",4).attr("fill","#6C8EF2"),r.append("line").attr("x1",t(c)).attr("y1",d.n([e(0),s-20])).attr("x2",t(c)).attr("y2",e(l[0].correlation[c])).attr("stroke","#6C8EF2").attr("stroke-width","2.5px");if(d.n(l[0].correlation)<0){var p=t(-1),f=t(l[0].correlation.length);r.append("line").attr("x1",p).attr("y1",e(0)).attr("x2",f).attr("y2",e(0)).attr("stroke","gray").attr("stroke-width","2px").attr("opacity",.8)}}}]),a}(y),kt=function(){function t(e){Object(r.a)(this,t),this._table=[],this._fact={},this._factdata=[],this._width=0,this._height=0,this._type=u.VERTICAL_BAR_CHART,this._duration=0,this._chart={},this._caption="",this._showSuggestion=!1,this._showTooltip=!1,this.props=e.props}return Object(n.a)(t,[{key:"size",value:function(){return this._size}},{key:"width",value:function(t){if(!t)return this._width;this._width=t}},{key:"height",value:function(t){if(!t)return this._height;this._height=t}},{key:"table",value:function(t){if(!t)return this._table;this._table=t}},{key:"data",value:function(t){if(!t)return this._factdata;this._factdata=t}},{key:"fact",value:function(t){if(!t)return this._fact;this._fact=t}},{key:"chart",value:function(t){if(!t)return this._chart;this._chart=t}},{key:"caption",value:function(t){if(!t)return this._caption;this._caption=t}},{key:"style",value:function(){return this._style}},{key:"showSuggestion",value:function(){return this._showSuggestion}},{key:"showTooltip",value:function(){return this._showTooltip}},{key:"load",value:function(t){var e=this;return this._width=t.width?t.width:0,this._height=t.height?t.height:0,this._style=t.style,this._type=t.type,this._duration=t.duration?t.duration:0,this._showSuggestion=!!t.showSuggestion&&t.showSuggestion,this._showTooltip=!!t.showTooltip&&t.showTooltip,new Promise((function(a,r){try{var n=e.data(),i=e.fact(),l=e._type2chart(t.type);l.height(e._height),l.width(e._width),l.table(e._table),l.factdata(n),l.subspace(i.subspace),l.measure(i.measure),l.breakdown(i.breakdown),l.focus(i.focus),l.duration(e._duration),l.showSuggestion(e._showSuggestion),l.showTooltip(e._showTooltip),e.chart(l),a(e)}catch(o){r(o)}}))}},{key:"update",value:function(){var t=this;return new Promise((function(e,a){try{var r=t.data(),n=t.fact();t._chart.factdata(r),t._chart.subspace(n.subspace),t._chart.measure(n.measure),t._chart.breakdown(n.breakdown),t._chart.focus(n.focus),t._chart.duration(t._duration),t._chart.showSuggestion(t._showSuggestion),t._chart.showTooltip(t._showTooltip),e(t)}catch(i){a(i)}}))}},{key:"_type2chart",value:function(t){switch(t){case u.MULTIVARIATE_OUTLIER:return new k(this.props);case u.UNIVARIATE_DISTRIBUTION:return new A(this.props);case u.TREND:return new S(this.props);case u.SEASONALITY:return new T(this.props);case u.MULTIVARIATE_DISTRIBUTION:return new N(this.props);case u.FREQUENT_PATTERN:return new L(this.props);case u.CLUSTERING:return new K(this.props);case u.FORECASTING:return new $(this.props);case u.UNIVARIATE_OUTLIER:return new at(this.props);case u.SIMILARITY:return new pt(this.props);case u.ORIGIN:return new xt(this.props);case u.AUTOCORRELATION:return new wt(this.props);case u.OUTSTANDING:return new mt(this.props);default:return}}}]),t}(),bt=function(){function t(){Object(r.a)(this,t),this._container="",this._paragraph="",this._vis={}}return Object(n.a)(t,[{key:"container",value:function(t){this._container=t}},{key:"paragraph",value:function(t){this._paragraph=t}},{key:"vis",value:function(t){if(!t)return this._vis;this._vis=t}},{key:"render",value:function(){var t=this.vis(),e=t.chart();e.container(this._container);var a=t.fact();0===e.duration()?e.display(a.type):e.animate(a.type)}},{key:"update",value:function(t,e){this.vis().chart().update(t,e)}},{key:"showCaption",value:function(){var t=this.vis();d.w(this._paragraph).style("font-size","1.5em").style("text-align","center").text(t.caption())}}]),t}(),_t=function(){function t(e){Object(r.a)(this,t),this._container=document.createElement("div"),this._paragraph=document.createElement("p"),this._data=new c,this._fact=new h,this._vis=new kt(e),this._display=new bt,this._spec={}}return Object(n.a)(t,[{key:"container",value:function(t){if(!t)return this._container;this._container=t}},{key:"paragraph",value:function(t){if(!t)return this._paragraph;this._paragraph=t}},{key:"load",value:function(t){this._spec=t}},{key:"shouldShowCaption",value:function(t){if(!t)return this._shouldShowCaption;this._shouldShowCaption=t}},{key:"generate",value:function(){var t=this,e=this._spec,a=e.data?e.data:{},r=e.fact?e.fact:{},n=e.chart?e.chart:{};this._data.load(a).then((function(e){return t._fact.table(e.table()),t._fact.schema(e.schema()),t._fact.load(r)})).then((function(e){return t._vis.table(e.table()),t._vis.data(e.factdata()),t._vis.fact(e.fact()),t._vis.load(n)})).then((function(e){t._display.container(t.container()),t._display.paragraph(t.paragraph()),t._display.vis(e),t._display.render(),t.shouldShowCaption()&&t._display.showCaption()})).catch((function(t){console.log(t)}))}}]),t}(),Ot=function(t){Object(i.a)(a,t);var e=Object(l.a)(a);function a(){return Object(r.a)(this,a),e.apply(this,arguments)}return Object(n.a)(a,[{key:"componentDidMount",value:function(){var t=this.props.spec.chart.id,e=this.props.spec,a=t?"#vischart_".concat(t):"#demo-chart";this.autovis=new _t(this),this.autovis.container(a),this.autovis.load(e),this.autovis.generate()}},{key:"componentDidUpdate",value:function(t){var e=this.props.spec.chart.id,a=this.props.spec,r=e?"#vischart_".concat(e):"#demo-chart";this.autovis=new _t(this),this.autovis.container(r),this.autovis.load(a),this.autovis.generate()}},{key:"render",value:function(){var t=this.props.spec.chart,e=t.width,a=t.height,r=void 0!==a?a:640,n=void 0!==e?e:400,i=(this.props.spec.chart?this.props.spec.chart:{id:"demo-chart"}).id;return s.a.createElement("div",{id:i?"vischart_".concat(i):"demo-chart",style:{height:r,width:n,position:"relative"}})}}]),a}(o.Component)}}]);
//# sourceMappingURL=5.2e73b90e.chunk.js.map